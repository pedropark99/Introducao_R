<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt-BR" xml:lang="pt-BR"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introdução à Linguagem R - 5&nbsp; Transformando dados com dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 1em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Capítulos/06-dados-relacionais.html" rel="next">
<link href="../Capítulos/03-importacao.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspondências adicionais",
    "search-more-match-text": "mais correspondência neste documento",
    "search-more-matches-text": "mais correspondências neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Capítulos/03-tidyverse.html">Importando, organizando e transformando dados</a></li><li class="breadcrumb-item"><a href="../Capítulos/04-transformacao.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transformando dados com <code>dplyr</code></span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Introdução à Linguagem R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduzindo a Linguagem R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/01-nocoes-basicas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Noções Básicas do R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/02-fundamentos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Fundamentos da Linguagem R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Importando, organizando e transformando dados</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/03-tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduzindo o universo do <code>tidyverse</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/03-importacao.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Importando e exportando dados com <code>readr</code>, <code>readxl</code> e <code>haven</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/04-transformacao.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transformando dados com <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/06-dados-relacionais.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introdução a base de dados relacionais com <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/07-tidy-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><em>Tidy Data</em>: uma abordagem para organizar os seus dados com <code>tidyr</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Visualizando seus dados</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/08-ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Visualização de dados com <code>ggplot2</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/09-theme-ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Configurando componentes estéticos do gráfico no <code>ggplot2</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Ferramentas para tipos específicos de dados</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/10-strings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Manipulação e transformação de <em>strings</em> com <code>stringr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/11-factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Introduzindo fatores (<em>factor</em>’s) com <code>forcats</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/12-variaveis-tempo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introdução à variáveis de tempo com <code>lubridate</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Funções e Loops: construindo os seus próprios programas e automatizando tarefas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/13-controle-fluxo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Controle condicional de fluxo</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/05-funcoes-loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Funções</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/17-loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title"><em>Loops</em></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/18-purrr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title"><em>Functional programming</em> com <code>purrr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/15-debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title"><em>Debugging</em> - Resolvendo <em>bugs</em> em suas funções</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/16-environments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title"><em>Environments</em> ou ambientes no R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Apêndices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Alternar seção">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercícios</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capítulos/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referências bibliográficas</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introdução-e-pré-requisitos" id="toc-introdução-e-pré-requisitos" class="nav-link active" data-scroll-target="#introdução-e-pré-requisitos"><span class="header-section-number">5.1</span> Introdução e pré-requisitos</a></li>
  <li><a href="#panorama-e-padrões-do-pacote-dplyr" id="toc-panorama-e-padrões-do-pacote-dplyr" class="nav-link" data-scroll-target="#panorama-e-padrões-do-pacote-dplyr"><span class="header-section-number">5.2</span> Panorama e padrões do pacote <code>dplyr</code></a></li>
  <li><a href="#operador-pipe-do-pacote-magrittr" id="toc-operador-pipe-do-pacote-magrittr" class="nav-link" data-scroll-target="#operador-pipe-do-pacote-magrittr"><span class="header-section-number">5.3</span> Operador <em>pipe</em> do pacote <code>magrittr</code> (<code>%&gt;%</code>)</a>
  <ul class="collapse">
  <li><a href="#o-que-o-pipe-faz" id="toc-o-que-o-pipe-faz" class="nav-link" data-scroll-target="#o-que-o-pipe-faz"><span class="header-section-number">5.3.1</span> O que o <em>pipe</em> faz ?</a></li>
  <li><a href="#o-que-o-pipe-não-é-capaz-de-fazer" id="toc-o-que-o-pipe-não-é-capaz-de-fazer" class="nav-link" data-scroll-target="#o-que-o-pipe-não-é-capaz-de-fazer"><span class="header-section-number">5.3.2</span> O que o <em>pipe</em> não é capaz de fazer ?</a></li>
  <li><a href="#duas-dicas-rápidas-sobre-o-pipe" id="toc-duas-dicas-rápidas-sobre-o-pipe" class="nav-link" data-scroll-target="#duas-dicas-rápidas-sobre-o-pipe"><span class="header-section-number">5.3.3</span> Duas dicas rápidas sobre o <em>pipe</em></a></li>
  </ul></li>
  <li><a href="#operador-pipe-nativo-do-r" id="toc-operador-pipe-nativo-do-r" class="nav-link" data-scroll-target="#operador-pipe-nativo-do-r"><span class="header-section-number">5.4</span> Operador <em>pipe</em> nativo do R (<code>|&gt;</code>)</a>
  <ul class="collapse">
  <li><a href="#utilizando-o-operador-pipe-nativo-no-rstudio" id="toc-utilizando-o-operador-pipe-nativo-no-rstudio" class="nav-link" data-scroll-target="#utilizando-o-operador-pipe-nativo-no-rstudio"><span class="header-section-number">5.4.1</span> Utilizando o operador <em>pipe</em> nativo no RStudio</a></li>
  </ul></li>
  <li><a href="#selecionando-colunas-com-select" id="toc-selecionando-colunas-com-select" class="nav-link" data-scroll-target="#selecionando-colunas-com-select"><span class="header-section-number">5.5</span> Selecionando colunas com <code>select()</code></a></li>
  <li><a href="#filtrando-linhas-com-filter" id="toc-filtrando-linhas-com-filter" class="nav-link" data-scroll-target="#filtrando-linhas-com-filter"><span class="header-section-number">5.6</span> Filtrando linhas com <code>filter()</code></a>
  <ul class="collapse">
  <li><a href="#cuidados-com-o-operador-de-igualdade" id="toc-cuidados-com-o-operador-de-igualdade" class="nav-link" data-scroll-target="#cuidados-com-o-operador-de-igualdade"><span class="header-section-number">5.6.1</span> Cuidados com o operador de igualdade</a></li>
  <li><a href="#estabelecendo-intervalos-com-a-função-between" id="toc-estabelecendo-intervalos-com-a-função-between" class="nav-link" data-scroll-target="#estabelecendo-intervalos-com-a-função-between"><span class="header-section-number">5.6.2</span> Estabelecendo intervalos com a função <code>between()</code></a></li>
  <li><a href="#sec:ataque_terrorista" id="toc-sec:ataque_terrorista" class="nav-link" data-scroll-target="#sec\:ataque_terrorista"><span class="header-section-number">5.6.3</span> Ataque terrorista</a></li>
  <li><a href="#condições-dependentes-ou-independentes" id="toc-condições-dependentes-ou-independentes" class="nav-link" data-scroll-target="#condições-dependentes-ou-independentes"><span class="header-section-number">5.6.4</span> Condições dependentes (&amp;) ou independentes (|) ?</a></li>
  </ul></li>
  <li><a href="#ordenando-linhas-com-arrange" id="toc-ordenando-linhas-com-arrange" class="nav-link" data-scroll-target="#ordenando-linhas-com-arrange"><span class="header-section-number">5.7</span> Ordenando linhas com <code>arrange()</code></a></li>
  <li><a href="#sec:mutate_dplyr" id="toc-sec:mutate_dplyr" class="nav-link" data-scroll-target="#sec\:mutate_dplyr"><span class="header-section-number">5.8</span> Adicionando variáveis à sua tabela com <code>mutate()</code></a></li>
  <li><a href="#sec:group_by_summarise" id="toc-sec:group_by_summarise" class="nav-link" data-scroll-target="#sec\:group_by_summarise"><span class="header-section-number">5.9</span> Agrupando dados com <code>group_by()</code> e gerando estatísticas sumárias com <code>summarise()</code></a></li>
  <li><a href="#distribuindo-cálculos-com-a-função-across" id="toc-distribuindo-cálculos-com-a-função-across" class="nav-link" data-scroll-target="#distribuindo-cálculos-com-a-função-across"><span class="header-section-number">5.10</span> Distribuindo cálculos com a função <code>across()</code></a></li>
  <li><a href="#removendo-duplicatas-com-distinct" id="toc-removendo-duplicatas-com-distinct" class="nav-link" data-scroll-target="#removendo-duplicatas-com-distinct"><span class="header-section-number">5.11</span> Removendo duplicatas com <code>distinct()</code></a></li>
  <li><a href="#combinando-tabelas-com-bind_cols-e-bind_rows" id="toc-combinando-tabelas-com-bind_cols-e-bind_rows" class="nav-link" data-scroll-target="#combinando-tabelas-com-bind_cols-e-bind_rows"><span class="header-section-number">5.12</span> Combinando tabelas com <code>bind_cols()</code> e <code>bind_rows()</code></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Capítulos/03-tidyverse.html">Importando, organizando e transformando dados</a></li><li class="breadcrumb-item"><a href="../Capítulos/04-transformacao.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transformando dados com <code>dplyr</code></span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transformando dados com <code>dplyr</code></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introdução-e-pré-requisitos" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="introdução-e-pré-requisitos"><span class="header-section-number">5.1</span> Introdução e pré-requisitos</h2>
<p>São raras as ocasiões em que os seus dados já se encontram no formato exato que você precisa para realizar as suas análises, ou para gerar os gráficos que você deseja <span class="citation" data-cites="wickham2017">(<a href="#ref-wickham2017" role="doc-biblioref">WICKHAM; GROLEMUND, 2017</a>)</span>. Por essa razão, você irá passar uma parte considerável de seu tempo calculando novas variáveis e aplicando transformações sobre os seus dados. Pelo fato de seus dados estarem, na maioria das situações, alocados em um <code>data.frame</code>, ou em um <code>tibble</code>, você precisa de ferramentas que sejam eficientes com tais estruturas <span class="citation" data-cites="peng2015">(<a href="#ref-peng2015" role="doc-biblioref">PENG, 2015</a>)</span>. Esse é o objetivo do pacote <code>dplyr</code> com o qual vamos trabalhar neste capítulo.</p>
<p>Para que você tenha acesso as funções e possa acompanhar os exemplos desse capítulo, você precisa chamar pelo pacote <code>dplyr</code>. Porém, vamos utilizar algumas bases de dados que estão disponíveis através de outros pacotes presentes no <code>tidyverse</code>. Por isso, é preferível que você chame pelo <code>tidyverse</code> por meio do comando <code>library()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="panorama-e-padrões-do-pacote-dplyr" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="panorama-e-padrões-do-pacote-dplyr"><span class="header-section-number">5.2</span> Panorama e padrões do pacote <code>dplyr</code></h2>
<p>Segundo a <a href="https://dplyr.tidyverse.org/">página oficial</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, o pacote <code>dplyr</code> oferece um conjunto de “verbos” (i.e.&nbsp;funções) para as operações mais comumente aplicadas em tabelas. Ou seja, as funções desse pacote em geral aceitam um <code>data.frame</code> como <em>input</em>, e retornam um novo <code>data.frame</code> como <em>output</em>. Dito de forma menos técnica, você fornece uma tabela para essas funções, e elas lhe retornam como resultado uma nova tabela.</p>
<p>Se você possui alguma experiência com <em>relational database management systems</em> (RDBMS), você vai acabar percebendo ao longo deste capítulo, que o pacote <code>dplyr</code> é profundamente inspirado nos verbos da linguagem SQL. Por esse motivo, muitos usuários tendem a chamar as funções do pacote <code>dplyr</code> de “verbos”. Logo abaixo, temos uma lista das principais funções oferecidas pelo pacote, além de uma descrição rápida da ação realizada por cada um desses verbos.</p>
<ol type="1">
<li><p><code>select()</code>: busca selecionar ou extrair colunas de seu <code>data.frame</code>.</p></li>
<li><p><code>filter()</code>: busca filtrar linhas de seu <code>data.frame</code>.</p></li>
<li><p><code>arrange()</code>: busca ordenar (ou organizar) as linhas de seu <code>data.frame</code>.</p></li>
<li><p><code>mutate()</code>: busca adicionar ou calcular novas colunas em seu <code>data.frame</code>.</p></li>
<li><p><code>summarise()</code>: busca sintetizar múltiplos valores de seu <code>data.frame</code> em um único valor.</p></li>
<li><p><code>group_by()</code>: permite que as operações sejam executadas dentro de cada “grupo” de seu <code>data.frame</code>; em outras palavras, a função busca definir os grupos existentes em seu <code>data.frame</code>, e deixar essa definição explícita e disponível para os outros verbos, de modo que eles possam respeitar esses grupos em suas operações.</p></li>
</ol>
<p>Dentre os verbos acima, o <code>group_by()</code> é definitivamente o mais difícil de se explicar de uma maneira clara e, ao mesmo tempo, resumida. De qualquer maneira, vamos discutir ele por extenso na seção <a href="#sec:group_by_summarise">Agrupando dados com <code>group_by()</code> e gerando estatísticas sumárias com <code>summarise()</code></a>. Além disso, também vamos abordar nesse capítulo, o uso do operador <em>pipe</em> (<code>%&gt;%</code>) que provêm do pacote <code>magrittr</code>, e que hoje, faz parte da identidade do pacote <code>dplyr</code>, e do <code>tidyverse</code> como um todo.</p>
<p><span class="citation" data-cites="peng2015">PENG (<a href="#ref-peng2015" role="doc-biblioref">2015</a>)</span> destacou algumas características compartilhadas pelas funções do pacote <code>dplyr</code>:</p>
<ol type="1">
<li><p>Possuem como primeiro argumento (<code>.data</code>), o <code>data.frame</code> no qual você deseja aplicar a função que você está utilizando.</p></li>
<li><p>Os argumentos subsequentes buscam descrever como e onde aplicar a função sobre o <code>data.frame</code> definido no primeiro argumento.</p></li>
<li><p>Geram um novo <code>data.frame</code> como resultado.</p></li>
<li><p>Como você definiu o <code>data.frame</code> a ser utilizando no primeiro argumento da função, você pode se referir às colunas desse <code>data.frame</code> apenas pelo seus nomes. Ou seja, dentro das funções do pacote <code>dplyr</code>, você não precisa mais do operador <code>$</code> para acessar as colunas do <code>data.frame</code> utilizado.</p></li>
</ol>
<p>No momento, essas características podem parecer confusas. Porém, você irá rapidamente reconhecê-las ao longo deste capítulo.</p>
</section>
<section id="operador-pipe-do-pacote-magrittr" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="operador-pipe-do-pacote-magrittr"><span class="header-section-number">5.3</span> Operador <em>pipe</em> do pacote <code>magrittr</code> (<code>%&gt;%</code>)</h2>
<p>Hoje, o operador <em>pipe</em> (<code>%&gt;%</code>) faz parte da identidade dos pacotes que compõe o <code>tidyverse</code>. Por esse motivo, você vai encontrar esse operador em praticamente todos os <em>script</em> que utilizam algum desses pacotes. Grande parte dessa identidade foi construída nos últimos anos, em especial, com a obra de <span class="citation" data-cites="wickham2017">WICKHAM; GROLEMUND (<a href="#ref-wickham2017" role="doc-biblioref">2017</a>)</span> que se tornou um importante livro-texto da linguagem R como um todo.</p>
<p>O operador <em>pipe</em> provêm do pacote <code>magrittr</code>, e o seu único objetivo é tornar o seu código mais claro e compreensível. Ou seja, o <em>pipe</em> em nada altera o resultado ou as configurações de seus comandos, ele apenas os organiza em uma estrutura mais limpa e arranjada. Apesar de sua origem ser o pacote <code>magrittr</code>, o <em>pipe</em> é carregado automaticamente quando chamamos pelo <code>tidyverse</code>, através do comando <code>library()</code>. Com isso, temos duas opções para termos acesso a esse operador: chamar diretamente pelo pacote <code>magrittr</code>, ou chamar pelo <code>tidyverse</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Com um desses comandos você</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">## pode utilizar o operador %&gt;% </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Ou</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>ATALHO:</strong> No RStudio, você pode escrever um <em>pipe</em> usando o atalho <code>Ctrl + Shift + M</code>.</p>
<p>Organizar o seu código é algo de extrema importância, e o <em>pipe</em> te ajuda a cumprir essa missão. Além disso, a estrutura em “cadeia” construída pelo <em>pipe</em> gera uma grande economia em seu tempo de trabalho, pois você não precisa mais se preocupar em salvar o resultado de vários passos intermediários em algum objeto.</p>
<p>Dessa maneira, você pode focar uma parte maior de seu tempo nas ações e transformações que você deseja aplicar, e no resultado que você deseja atingir. Para mais, essa estrutura também vai salvar muito de seu tempo, nos momentos em que você retornar ao seu trabalho no dia seguinte. Pois o seu código fica mais claro e fácil de se ler nessa estrutura. Com isso, você pode recuperar com maior rapidez a compreensão do ponto em que você parou no dia anterior.</p>
<p>Isso é muito importante, pois você nunca está trabalhando sozinho! Você sempre está, no mínimo, trabalhando com o seu futuro eu <span class="citation" data-cites="wickham2017">(<a href="#ref-wickham2017" role="doc-biblioref">WICKHAM; GROLEMUND, 2017</a>)</span>. Por isso, qualquer quantidade de tempo que você emprega para tornar os seus comandos mais legíveis e eficientes, você estará automaticamente economizando o seu tempo no dia seguinte, quando você terá de retornar a esses comandos, e prosseguir com o seu trabalho.</p>
<p>Para mais, os seus possíveis colegas de trabalho, ou outras pessoas que estiverem envolvidas no desenvolvimento de seu <em>script</em>, vão compreender de maneira mais eficiente as transformações que você está aplicando e, portanto, vão ser capazes de contribuir com o seu trabalho de maneira mais rápida.</p>
<section id="o-que-o-pipe-faz" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="o-que-o-pipe-faz"><span class="header-section-number">5.3.1</span> O que o <em>pipe</em> faz ?</h3>
<p>Em qualquer análise, temos em geral diversas etapas ou transformações a serem executadas, e em sua maioria, essas etapas assumem uma ordem específica. Quando realizamos essas etapas no R, nós comumente salvamos os resultados de cada passo em novos objetos, e utilizamos esses objetos “intermediários” em cada operação adicional para chegarmos ao resultado final que desejamos. Perceba no exemplo abaixo, o trabalho que temos ao salvarmos os resultados de cada passo em um objeto, e utilizarmos esse objeto na próxima transformação.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dados <span class="ot">&lt;-</span> mpg</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>agrupamento <span class="ot">&lt;-</span> <span class="fu">group_by</span>(<span class="at">.data =</span> dados, class)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>base_ordenada <span class="ot">&lt;-</span> <span class="fu">arrange</span>(<span class="at">.data =</span> agrupamento, hwy)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>base_completa <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">.data =</span> base_ordenada,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">media =</span> <span class="fu">mean</span>(hwy),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">desvio =</span> hwy <span class="sc">-</span> media</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Aqui se encontra uma vantagem muito importante do operador <em>pipe</em>, pois ele elimina essa necessidade de objetos “intermediários”, ao “carregar” os resultados ao longo de diversas funções. Em outras palavras, esse operador funciona como uma ponte (ou uma “conexão”) entre cada etapa, ou entre cada função aplicada. Dito de uma maneira mais específica, quando conectamos duas funções por um <em>pipe</em>, o operador carrega o resultado da primeira função, e o insere como o primeiro argumento da segunda função. Com isso, eu posso reescrever os comandos anteriores da seguinte forma:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(hwy) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">media =</span> <span class="fu">mean</span>(hwy),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">desvio =</span> hwy <span class="sc">-</span> media</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Além das vantagens destacadas até o momento, ao evitar o uso de objetos “intermediários”, o <em>pipe</em> acaba evitando que você use desnecessariamente a memória de seu computador. Pois cada objeto criado no R, precisa ocupar um espaço de sua memória RAM para permanecer “vivo” e disponível em sua sessão. Como estamos evitando criar novos objetos “intermediários”, estamos utilizando menos memória para realizar exatamente as mesmas etapas e gerar os mesmos resultados.</p>
<p>Apenas para que o uso do <em>pipe</em> fique claro, se eu possuo as funções <code>x()</code>, <code>y()</code> e <code>z()</code>, e desejo calcular a expressão <code>z(y(x(10), times = 1), n = 20, replace = TRUE)</code>, nós podemos reescrever essa expressão do modo exposto abaixo. Dessa maneira, o <em>pipe</em> vai pegar o resultado de <code>x(10)</code>, e inseri-lo como o primeiro argumento da função <code>y()</code>; depois de calcular o resultado da função <code>y()</code>, o próximo <em>pipe</em> vai passá-lo para o primeiro argumento da função <code>z()</code>; e como a função <code>z()</code> é a última função da cadeia, o console vai lhe mostrar o resultado final desse processo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Expressão original</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">z</span>(<span class="fu">y</span>(<span class="fu">x</span>(<span class="dv">10</span>), <span class="at">times =</span> <span class="dv">1</span>), <span class="at">n =</span> <span class="dv">20</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Com o uso do pipe %&gt;% </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">x</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">y</span>(<span class="at">times =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">z</span>(<span class="at">n =</span> <span class="dv">20</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="o-que-o-pipe-não-é-capaz-de-fazer" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="o-que-o-pipe-não-é-capaz-de-fazer"><span class="header-section-number">5.3.2</span> O que o <em>pipe</em> não é capaz de fazer ?</h3>
<p>O <em>pipe</em> não é capaz de trabalhar perfeitamente com qualquer função, e a principal característica que você precisa observar para identificar se essa afirmação é verdadeira ou falsa para uma dada função, é o seu primeiro argumento.</p>
<p>Como o <em>pipe</em> insere o <strong>resultado</strong> da expressão anterior no primeiro argumento da próxima função, esse primeiro argumento precisa corresponder ao argumento no qual você deseja utilizar esse <strong>resultado</strong>. Na maior parte do tempo, desejamos utilizar esse <strong>resultado</strong> como os dados sobre os quais vamos aplicar a nossa próxima função.</p>
<p>Este é um dos principais motivos pelos quais praticamente todas as funções de todos os pacotes que compõe o <code>tidyverse</code>, trabalham perfeitamente bem com o operador <em>pipe</em>. Pois todas essas funções possuem como primeiro argumento, algo parecido com <code>.data</code>, <code>data</code> ou <code>x</code>, que busca definir o objeto sobre o qual vamos aplicar a função.</p>
<p>Porém, caso o argumento a ser utilizado, esteja em uma posição diferente (se trata do segundo, terceiro ou quarto argumento da função), você pode utilizar um ponto final (<code>.</code>) para alterar a posição em que o resultado das etapas anteriores será introduzido. Basta posicionar o ponto final no argumento em que você deseja inserir esse resultado.</p>
<p>Um clássico exemplo que se encaixa nessa hipótese, é a função <code>lm()</code>, que é a principal função empregada no cálculo de uma regressão linear no R. Nessa função, o primeiro argumento corresponde a fórmula a ser utilizada na regressão; já os dados a serem usados na regressão, são delimitados no segundo argumento da função (<code>data</code>). Veja no exemplo abaixo, que eu utilizo um ponto final sobre o argumento <code>data</code>, para dizer ao <em>pipe</em> que ele deve inserir o resultado anterior especificamente nesse argumento.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(hwy <span class="sc">~</span> cyl, <span class="at">data =</span> .)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hwy ~ cyl, data = .)

Coefficients:
(Intercept)          cyl  
     40.019       -2.815  </code></pre>
</div>
</div>
</section>
<section id="duas-dicas-rápidas-sobre-o-pipe" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="duas-dicas-rápidas-sobre-o-pipe"><span class="header-section-number">5.3.3</span> Duas dicas rápidas sobre o <em>pipe</em></h3>
<p>O <em>pipe</em> cria uma espécie de efeito em cadeia, e muitas vezes nos preocupamos demais com as etapas dessa cadeia, e nos esquecemos de definir o local em que o resultado dessa cadeia deve ocupar. Portanto, lembre-se que para salvar o resultado final da cadeia formada pelos seus <em>pipe</em>’s, você necessita salvar esse resultado em algum objeto. Para isso, você deve posicionar o nome do objeto, e o símbolo de <em>assignment</em> (<code>&lt;-</code>), logo no início dessa cadeia, como no exemplo abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(hwy) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">consumo_medio =</span> <span class="fu">mean</span>(hwy),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">desvio_consumo =</span> hwy <span class="sc">-</span> consumo_medio</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    manufacturer, model, class,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    consumo_medio, desvio_consumo</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>resultado</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 5
# Groups:   class [7]
  manufacturer model               class  consumo_medio desvio_consumo
  &lt;chr&gt;        &lt;chr&gt;               &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;
1 dodge        dakota pickup 4wd   pickup          16.9          -4.88
2 dodge        durango 4wd         suv             18.1          -6.13
3 dodge        ram 1500 pickup 4wd pickup          16.9          -4.88
4 dodge        ram 1500 pickup 4wd pickup          16.9          -4.88
5 jeep         grand cherokee 4wd  suv             18.1          -6.13
# ℹ 229 more rows</code></pre>
</div>
</div>
<p>Uma outra dica, seria não formar cadeias muito longas. Se você precisa aplicar várias transformações em sequência sobre o mesmo objeto, tente dividir essas várias transformações em vários “blocos” de <em>pipe</em>’s. Como um guia, o ideal é que uma cadeia de <em>pipe</em>’s nunca passe de 10 etapas. Caso você precise aplicar mais do que 10 etapas, é melhor que você salve o resultado da 10° etapa em um objeto, e inicie uma nova cadeia de <em>pipe</em>’s a partir deste objeto.</p>
</section>
</section>
<section id="operador-pipe-nativo-do-r" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="operador-pipe-nativo-do-r"><span class="header-section-number">5.4</span> Operador <em>pipe</em> nativo do R (<code>|&gt;</code>)</h2>
<p>Depois do grande sucesso do operador <em>pipe</em> criado pelo pacote <code>magrittr</code> (<code>%&gt;%</code>), a equipe que mantém a linguagem R decidiu desenvolver um operador <em>pipe</em> nativo para a linguagem. Tal operador possui o formato <code>|&gt;</code>, e foi oficialmente introduzido na versão 4.1 do R.</p>
<p>Em resumo, o operador <code>|&gt;</code> possui a exata mesma funcionalidade do operador <code>%&gt;%</code>. Ou seja, ele pega o resultado da função a esquerda, e, o transfere para o primeiro argumento da função a direita. Logo, poderíamos tranquilamente reescrever o exemplo anterior, ao substituir o operador <code>%&gt;%</code> por <code>|&gt;</code>, produzindo assim, o mesmo resultado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> mpg <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(hwy) <span class="sc">|&gt;</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">consumo_medio =</span> <span class="fu">mean</span>(hwy),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">desvio_consumo =</span> hwy <span class="sc">-</span> consumo_medio</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    manufacturer, model, class,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    consumo_medio, desvio_consumo</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>resultado</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 5
# Groups:   class [7]
  manufacturer model               class  consumo_medio desvio_consumo
  &lt;chr&gt;        &lt;chr&gt;               &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;
1 dodge        dakota pickup 4wd   pickup          16.9          -4.88
2 dodge        durango 4wd         suv             18.1          -6.13
3 dodge        ram 1500 pickup 4wd pickup          16.9          -4.88
4 dodge        ram 1500 pickup 4wd pickup          16.9          -4.88
5 jeep         grand cherokee 4wd  suv             18.1          -6.13
# ℹ 229 more rows</code></pre>
</div>
</div>
<p>Contudo, apesar de realizar o mesmo trabalho, o operador <code>|&gt;</code> possui três características importantes:</p>
<ol type="1">
<li><p>Primeiro, esse operador é nativo. Ou seja, ele vem “de fábrica”, junto com o R. Logo, você não precisa chamar por nenhum pacote extra para utilizá-lo;</p></li>
<li><p>Segundo, enquanto o operador <code>%&gt;%</code> executa cada uma das etapas de forma sequencial, o operador <code>|&gt;</code> utiliza uma transformação sintática (<em>syntax transformation</em>) para agrupar todas as etapas em uma única chamada;</p></li>
<li><p>Terceiro, enquanto o operador <code>%&gt;%</code> utiliza um ponto final para alterar a posição em que o resultado será inserido, o operador <code>|&gt;</code> utiliza um <em>underline</em> (<code>_</code>) para realizar esse serviço;</p></li>
</ol>
<p>Quanto à segunda característica supracitada, o operador <code>|&gt;</code> sempre realiza uma transformação sintática sobre a sua cadeia de operações, antes de executá-la. Em outras palavras, ele reescreve os comandos em sua cadeia, com o objetivo de agrupar todas as operações em um único comando. Você pode ver o resultado desse processo, ao revelar a expressão gerada por uma cadeia qualquer, com a função <code>quote()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quote</span>({</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  mpg <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(hwy) <span class="sc">|&gt;</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">consumo_medio =</span> <span class="fu">mean</span>(hwy),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">desvio_consumo =</span> hwy <span class="sc">-</span> consumo_medio</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    manufacturer, model, class,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    consumo_medio, desvio_consumo</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>## {
##     select(mutate(arrange(group_by(mpg, class), hwy),
##        consumo_medio = mean(hwy), 
##        desvio_consumo = hwy - consumo_medio),
##        manufacturer, model, class,
##        consumo_medio, desvio_consumo)
## }</code></pre>
<p>Portanto, o operador <code>|&gt;</code> agrupa todas as suas operações em um único comando, e, em seguida, executa esse comando único para adquirir o resultado final de sua cadeia. Em contrapartida, o operador <code>%&gt;%</code> executa cada uma das etapas de sua cadeia de forma separada.</p>
<p>Quanto à terceira característica supracitada, para alterarmos a posição em que o resultado da expressão anterior é inserido, precisamos utilizar um <em>underline</em> ao invés de um ponto final (como ocorre com <code>%&gt;%</code>). Vale destacar que este <em>underline</em> é permitido apenas em argumentos nomeados. Em outras palavras, a expressão <code>x |&gt; y(10, _)</code> não é permitida, enquanto a expressão <code>x |&gt; y(10, z = _)</code> é.</p>
<p>Tendo isso em mente, para reproduzirmos o exemplo anterior dado com a função <code>lm()</code>, teríamos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(hwy <span class="sc">~</span> cyl, <span class="at">data =</span> _) </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = hwy ~ cyl, data = mpg)

Coefficients:
(Intercept)          cyl  
     40.019       -2.815  </code></pre>
</div>
</div>
<section id="utilizando-o-operador-pipe-nativo-no-rstudio" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="utilizando-o-operador-pipe-nativo-no-rstudio"><span class="header-section-number">5.4.1</span> Utilizando o operador <em>pipe</em> nativo no RStudio</h3>
<p>Em versões mais recentes do RStudio, você pode utilizar o pipe nativo do R através do atalho <code>Crtl + Shift + M</code>. Basta acessar a janela de configurações globais, através de <code>Tools</code> <span class="math inline">\(\rightarrow\)</span> <code>Global Options...</code>, depois, ir na seção de <code>Code</code>, e, marcar a caixa <em>“Use native pipe operator |&gt;”</em>, como demonstrado na <a href="#fig-pipe-native-option" class="quarto-xref">Figura&nbsp;<span>5.1</span></a> abaixo:</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pipe-native-option" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pipe-native-option-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./../Figuras/native_pipe_operator.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pipe-native-option-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.1: RStudio - opção para utilizar o <em>pipe</em> nativo do R
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="selecionando-colunas-com-select" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="selecionando-colunas-com-select"><span class="header-section-number">5.5</span> Selecionando colunas com <code>select()</code></h2>
<p>Como definimos anteriormente, a função <code>select()</code> busca selecionar colunas de seu <code>data.frame</code>. Você já possui uma boa ideia de como realizar essa ação através da função de <em>subsetting</em> (<code>[</code>). Porém, nós podemos usufruir da flexibilidade oferecida pela função <code>select()</code>, que lhe permite realizar essa mesma operação de diversas maneiras intuitivas.</p>
<p>No geral, temos ao menos 5 métodos diferentes que podemos utilizar na função <code>select()</code>:</p>
<ol type="1">
<li><p>simplesmente listar o nome das colunas que desejamos;</p></li>
<li><p>fornecer um vetor externo, contendo os nomes das colunas a serem extraídas;</p></li>
<li><p>selecionar um conjunto de colunas com base em seu tipo (<code>integer</code>, <code>double</code>, <code>character</code>, <code>logical</code>);</p></li>
<li><p>selecionar um conjunto de colunas com base em padrões que aparecem nos nomes dessas colunas (nome começa por y, ou termina em z, ou contém x);</p></li>
<li><p>selecionar um conjunto de colunas com base em seus índices numéricos (1° coluna, 2° coluna, 3° coluna, etc.).</p></li>
</ol>
<p>Como exemplo inicial, vamos utilizar a tabela <code>billboard</code>, que apresenta a posição de diversas músicas na lista Billboard Top 100, ao longo do ano 2000. Se você chamou com sucesso pelo <code>tidyverse</code>, você tem acesso a essa tabela. Perceba que a posição de cada música descrita na tabela, é apresentada de forma semanal, onde cada semana possui a sua coluna própria. Por essa razão, temos uma quantidade exorbitante de colunas na tabela.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>billboard</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 317 × 79
  artist      track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
  &lt;chr&gt;       &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 2 Pac       Baby… 2000-02-26      87    82    72    77    87    94    99    NA
2 2Ge+her     The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA
3 3 Doors Do… Kryp… 2000-04-08      81    70    68    67    66    57    54    53
4 3 Doors Do… Loser 2000-10-21      76    76    72    69    67    65    55    59
5 504 Boyz    Wobb… 2000-04-15      57    34    25    17    17    31    36    49
# ℹ 312 more rows
# ℹ 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>O método 5 citado acima é um dos métodos mais práticos e eficientes de se utilizar a função <code>select()</code>. Por exemplo, se desejássemos extrair todas as colunas entre a 1° e 4° colunas da tabela, poderíamos fornecer um vetor à função, contendo uma sequência de 1 a 4, que representa os índices das colunas que desejamos, como no exemplo abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>billboard_sel <span class="ot">&lt;-</span> <span class="fu">select</span>(billboard, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>billboard_sel</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 317 × 4
  artist       track                   date.entered   wk1
  &lt;chr&gt;        &lt;chr&gt;                   &lt;date&gt;       &lt;dbl&gt;
1 2 Pac        Baby Don't Cry (Keep... 2000-02-26      87
2 2Ge+her      The Hardest Part Of ... 2000-09-02      91
3 3 Doors Down Kryptonite              2000-04-08      81
4 3 Doors Down Loser                   2000-10-21      76
5 504 Boyz     Wobble Wobble           2000-04-15      57
# ℹ 312 more rows</code></pre>
</div>
</div>
<p>Agora, e se você precisasse selecionar todas as colunas que representam as semanas? Nesse caso, o método 5 ainda seria uma boa alternativa, pois você precisaria apenas fornecer uma sequência que represente a posição dessas colunas na tabela (de 4 a 79 para ser mais preciso).</p>
<p>Porém, todas essas colunas possuem um padrão em seus nomes. Elas se iniciam pelos caracteres <code>"wk"</code>, acrescidos de um número que representa o índice da semana que essa coluna corresponde. Portanto, em todas as ocasiões que houver algum padrão presente nos nomes das colunas que você deseja selecionar, o método 4 que citamos configura-se como uma ótima solução. Nesse método, devemos utilizar as funções de suporte <code>starts_with()</code>, <code>ends_with()</code>, <code>matches()</code>.</p>
<p>Como os seus próprios nomes dão a entender, as funções <code>starts_with()</code> e <code>ends_with()</code> vão selecionar qualquer coluna de sua tabela que comece (<em>start</em>) ou termine (<em>end</em>) por uma determinada cadeia de caracteres, respectivamente. Como exemplo, eu posso selecionar todas as colunas que apresentam as posições semanais na tabela <code>billboard</code>, ao encontrar todas as colunas que começam pelas letras <code>"wk"</code>, com a função <code>starts_with()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>billboard_sel <span class="ot">&lt;-</span> <span class="fu">select</span>(billboard, <span class="fu">starts_with</span>(<span class="st">"wk"</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>billboard_sel</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 317 × 76
    wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8   wk9  wk10  wk11  wk12  wk13
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    87    82    72    77    87    94    99    NA    NA    NA    NA    NA    NA
2    91    87    92    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
3    81    70    68    67    66    57    54    53    51    51    51    51    47
4    76    76    72    69    67    65    55    59    62    61    61    59    61
5    57    34    25    17    17    31    36    49    53    57    64    70    75
# ℹ 312 more rows
# ℹ 63 more variables: wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Já a função <code>matches()</code> se trata de um caso muito mais flexível das funções <code>starts_with()</code> e <code>ends_with()</code>, pois ela lhe permite selecionar qualquer coluna cujo o nome se encaixa em uma dada expressão regular. Expressões regulares são uma poderosa ferramenta para processamento de texto, a qual vamos discutir no capítulo Manipulação e transformação de <em>strings</em> com <code>stringr</code>, especialmente na seção <a href="10-strings.html#sec:stringr_regex">Expressões regulares (ou <em>regex</em>) com <code>str_detect()</code></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Seleciona todas as semanas que são</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="do">## maiores do que 9 e menores do que 100.</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Ou seja, toda semana com dois dígitos</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"wk[0-9]{2}"</span>)) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 317 × 67
   wk10  wk11  wk12  wk13  wk14  wk15  wk16  wk17  wk18  wk19  wk20  wk21  wk22
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
2    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
3    51    51    51    47    44    38    28    22    18    18    14    12     7
4    61    61    59    61    66    72    76    75    67    73    70    NA    NA
5    57    64    70    75    76    78    85    92    96    NA    NA    NA    NA
# ℹ 312 more rows
# ℹ 54 more variables: wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Seleciona todas as colunas cujo nome</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="do">## possua um ponto final antecedido por</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 letras</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"[a-z]{4}[.]"</span>)) <span class="sc">%&gt;%</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 317 × 1
  date.entered
  &lt;date&gt;      
1 2000-02-26  
2 2000-09-02  
3 2000-04-08  
4 2000-10-21  
5 2000-04-15  
# ℹ 312 more rows</code></pre>
</div>
</div>
<p>Essas são maneiras eficientes de selecionarmos um grande conjunto de colunas, porém, muitas vezes as nossas necessidades são pequenas e, portanto, não exigem mecanismos tão poderosos.</p>
<p>Nessas situações, o método 1 se torna útil pois ele consiste em simplesmente listarmos o nome das colunas desejadas. Como exemplo, eu posso selecionar as colunas <code>artist</code>, <code>track</code> e <code>wk5</code> da tabela <code>billboard</code> pelo comando abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span> <span class="fu">select</span>(artist, track, wk5)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 317 × 3
  artist       track                     wk5
  &lt;chr&gt;        &lt;chr&gt;                   &lt;dbl&gt;
1 2 Pac        Baby Don't Cry (Keep...    87
2 2Ge+her      The Hardest Part Of ...    NA
3 3 Doors Down Kryptonite                 66
4 3 Doors Down Loser                      67
5 504 Boyz     Wobble Wobble              17
# ℹ 312 more rows</code></pre>
</div>
</div>
<p>Vale destacar que a ordem dos índices utilizados importa para a função <code>select()</code>. Logo, se no exemplo acima, eu listasse as colunas na ordem <code>track</code>, <code>wk5</code> e <code>artist</code>, o novo <code>data.frame</code> resultante de <code>select()</code>, iria conter essas colunas precisamente nessa ordem.</p>
<p>O mesmo efeito seria produzido, caso eu utilizasse novamente o método 5, e fornecesse o vetor <code>c(3, 2, 4)</code> à função. Dessa forma, <code>select()</code> iria me retornar um novo <code>data.frame</code> contendo 3 colunas, que correspondem a 3°, 2° e 4° colunas da tabela <code>billboard</code>, exatamente nessa ordem.</p>
<p>Por outro lado, não há uma maneira de variarmos a ordem dos resultados gerados nos métodos 3 e 4, especificamente. Por isso, caso você utilize um desses dois métodos, as colunas selecionadas serão apresentadas no novo <code>data.frame</code>, precisamente na ordem em que eles aparecem no <code>data.frame</code> inicial.</p>
<p>Visto esses pontos, ao invés de selecionar colunas, você também pode utilizar o método 1 para rapidamente eliminar algumas colunas de seu <code>data.frame</code>, ao posicionar um sinal negativo (<code>-</code>) antes do nome da coluna que você deseja retirar. Por exemplo, eu posso selecionar todas as colunas da tabela <code>mpg</code>, exceto as colunas <code>hwy</code> e <code>manufacturer</code> por meio do seguinte comando:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>hwy, <span class="sc">-</span>manufacturer)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 9
  model displ  year   cyl trans      drv     cty fl    class  
  &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  
1 a4      1.8  1999     4 auto(l5)   f        18 p     compact
2 a4      1.8  1999     4 manual(m5) f        21 p     compact
3 a4      2    2008     4 manual(m6) f        20 p     compact
4 a4      2    2008     4 auto(av)   f        21 p     compact
5 a4      2.8  1999     6 auto(l5)   f        16 p     compact
# ℹ 229 more rows</code></pre>
</div>
</div>
<p>Em contrapartida, o método 3 busca selecionar um conjunto de colunas com base em seu tipo de dado, através da função <code>where()</code> e das funções de teste lógico <code>is.*()</code> (<code>is.double</code>, <code>is.character</code>, <code>is.integer</code>, …). Como exemplo, nós podemos selecionar todas as colunas da tabela <code>billboard</code> que contém dados textuais, através do comando abaixo. Portanto, para utilizar esse método você precisa apenas se referir a função <code>is.*()</code> que corresponde ao tipo de dado no qual você está interessado, dentro da função <code>where()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.character))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 317 × 2
  artist       track                  
  &lt;chr&gt;        &lt;chr&gt;                  
1 2 Pac        Baby Don't Cry (Keep...
2 2Ge+her      The Hardest Part Of ...
3 3 Doors Down Kryptonite             
4 3 Doors Down Loser                  
5 504 Boyz     Wobble Wobble          
# ℹ 312 more rows</code></pre>
</div>
</div>
<p>Com isso, você possui não apenas uma boa variedade de métodos disponíveis na função <code>select()</code>, mas você também é capaz de misturá-los livremente dentro da função. Ou seja, se for de meu desejo, eu posso utilizar os métodos 2, 4 e 5 ao mesmo tempo, como no exemplo abaixo. Tratando especificamente do método 2, eu preciso fornecer dentro da função <code>all_of()</code>, um vetor contendo os nomes das colunas desejadas.</p>
<p>Como exemplo, eu posso novamente extrair as colunas <code>artist</code>, <code>track</code> e <code>wk5</code> através desse método. O método 2, em particular, se torna um método interessante quando ainda não conhecemos o conjunto de colunas a serem extraídas. Talvez você precise aplicar previamente diversos testes sobre o seu <code>data.frame</code>, para identificar essas colunas. Logo, um vetor contendo os nomes das colunas desejadas seria o resultado ideal para tais testes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"artist"</span>, <span class="st">"track"</span>, <span class="st">"wk5"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>billboard <span class="sc">%&gt;%</span> <span class="fu">select</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all_of</span>(vec),  <span class="do">## Método 2</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>,  <span class="do">## Método 5</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matches</span>(<span class="st">"wk[0-9]{2}"</span>)  <span class="do">## Método 4</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 317 × 73
  artist      track   wk5 date.entered   wk1   wk2  wk10  wk11  wk12  wk13  wk14
  &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 2 Pac       Baby…    87 2000-02-26      87    82    NA    NA    NA    NA    NA
2 2Ge+her     The …    NA 2000-09-02      91    87    NA    NA    NA    NA    NA
3 3 Doors Do… Kryp…    66 2000-04-08      81    70    51    51    51    47    44
4 3 Doors Do… Loser    67 2000-10-21      76    76    61    61    59    61    66
5 504 Boyz    Wobb…    17 2000-04-15      57    34    57    64    70    75    76
# ℹ 312 more rows
# ℹ 62 more variables: wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="filtrando-linhas-com-filter" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="filtrando-linhas-com-filter"><span class="header-section-number">5.6</span> Filtrando linhas com <code>filter()</code></h2>
<p>Você também já possui conhecimento para realizar essa operação através da função de <em>subsetting</em> (<code>[</code>). Porém, novamente o pacote <code>dplyr</code> nos oferece uma alternativa mais intuitiva. A função <code>filter()</code> busca filtrar linhas de uma tabela de acordo com uma condição lógica de nossa escolha. Ou seja, os operadores lógicos são primordiais para essa função. Por isso, temos na <a href="#fig-operadores-logicos" class="quarto-xref">Figura&nbsp;<span>5.2</span></a>, um resumo de cada um deles.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-operadores-logicos" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-operadores-logicos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./../Figuras/tab_operadores.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-operadores-logicos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5.2: Lista de operadores lógicos
</figcaption>
</figure>
</div>
</div>
</div>
<p>Portanto, ao utilizar a função <code>filter()</code> você deve construir uma condição lógica que seja capaz de identificar as linhas que você deseja filtrar. Como exemplo inicial, nós podemos retornar à tabela <code>mpg</code>, que contém dados de consumo de diversos modelos de carro. Por exemplo, nós podemos filtrar todas as linhas que dizem respeito a modelos da Toyota, através do comando abaixo. Como um paralelo, temos mais abaixo a mesma operação segundo a função de <em>subsetting</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(manufacturer <span class="sc">==</span> <span class="st">"toyota"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34 × 11
  manufacturer model       displ  year   cyl trans drv     cty   hwy fl    class
  &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
1 toyota       4runner 4wd   2.7  1999     4 manu… 4        15    20 r     suv  
2 toyota       4runner 4wd   2.7  1999     4 auto… 4        16    20 r     suv  
3 toyota       4runner 4wd   3.4  1999     6 auto… 4        15    19 r     suv  
4 toyota       4runner 4wd   3.4  1999     6 manu… 4        15    17 r     suv  
5 toyota       4runner 4wd   4    2008     6 auto… 4        16    20 r     suv  
# ℹ 29 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> mpg<span class="sc">$</span>manufacturer <span class="sc">==</span> <span class="st">"toyota"</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>mpg[clog, ]</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Múltiplas condições lógicas podem ser construídas dentro da função <code>filter()</code>. Por exemplo, podemos ser um pouco mais específicos e selecionarmos apenas os modelos da Toyota que possuem um motor de 4 cilindradas com o comando abaixo. Repare abaixo, que ao acrescentarmos novas condições na função <code>filter()</code>, elas acabam se tornando dependentes. Ou seja, ambas as condições devem ser atendidas ao mesmo tempo em cada linha retornada pela função <code>filter()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(manufacturer <span class="sc">==</span> <span class="st">"toyota"</span>, cyl <span class="sc">==</span> <span class="dv">4</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 11
  manufacturer model       displ  year   cyl trans drv     cty   hwy fl    class
  &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
1 toyota       4runner 4wd   2.7  1999     4 manu… 4        15    20 r     suv  
2 toyota       4runner 4wd   2.7  1999     4 auto… 4        16    20 r     suv  
3 toyota       camry         2.2  1999     4 manu… f        21    29 r     mids…
4 toyota       camry         2.2  1999     4 auto… f        21    27 r     mids…
5 toyota       camry         2.4  2008     4 manu… f        21    31 r     mids…
# ℹ 13 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> mpg<span class="sc">$</span>manufacturer <span class="sc">==</span> <span class="st">"toyota"</span> <span class="sc">&amp;</span> mpg<span class="sc">$</span>cyl <span class="sc">==</span> <span class="dv">4</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>mpg[clog, ]</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nós tradicionalmente estabelecemos relações de dependência entre condições lógicas, por meio do operador <code>&amp;</code>. Mas a função <code>filter()</code> busca ser prática e, por isso, ela automaticamente realiza esse trabalho por nós. Porém, isso implica que se as suas condições forem independentes, ajustes precisam ser feitos, através do operador <code>|</code>.</p>
<p>Visto esse ponto, você pode estar interessado em filtrar a sua tabela, de acordo com um conjunto de valores. Por exemplo, ao invés de selecionar apenas os modelos pertencentes à Toyota, podemos selecionar um conjunto maior de marcas. Em ocasiões como essa, o operador <code>%in%</code> se torna útil, pois você está pesquisando se o valor presente em cada linha de sua tabela, pertence ou não a um dado conjunto de valores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>marcas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"volkswagen"</span>, <span class="st">"audi"</span>, <span class="st">"toyota"</span>, <span class="st">"honda"</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(manufacturer <span class="sc">%in%</span> marcas)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 88 × 11
  manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
  &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
1 audi         a4      1.8  1999     4 auto(l5)   f        18    29 p     compa…
2 audi         a4      1.8  1999     4 manual(m5) f        21    29 p     compa…
3 audi         a4      2    2008     4 manual(m6) f        20    31 p     compa…
4 audi         a4      2    2008     4 auto(av)   f        21    30 p     compa…
5 audi         a4      2.8  1999     6 auto(l5)   f        16    26 p     compa…
# ℹ 83 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>marcas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"volkswagen"</span>, <span class="st">"audi"</span>, <span class="st">"toyota"</span>, <span class="st">"honda"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> mpg<span class="sc">$</span>manufacturer <span class="sc">%in%</span> marcas</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>mpg[clog, ]</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="cuidados-com-o-operador-de-igualdade" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="cuidados-com-o-operador-de-igualdade"><span class="header-section-number">5.6.1</span> Cuidados com o operador de igualdade</h3>
<p>Quando você estiver filtrando as linhas de sua tabela de acordo com uma condição de igualdade, é importante que você tome alguns cuidados, especialmente se valores textuais estiverem envolvidos nessa condição. O primeiro ponto a ser abordado é o uso do operador <code>==</code>, que para além de igualdade, ele busca encontrar valores <strong>exatamente</strong> iguais.</p>
<p>O “exatamente” é importante aqui, pois certos valores numéricos podem ser aparentemente idênticos aos nossos olhos, mas ainda assim, diferentes segundo a visão de <code>==</code>. Isso ocorre especialmente com valores numéricos do tipo <code>double</code>. Pois os nossos computadores utilizam precisão aritmética finita para guardar esse tipo de valor <span class="citation" data-cites="wickham2017">(<a href="#ref-wickham2017" role="doc-biblioref">WICKHAM; GROLEMUND, 2017, p. 47</a>)</span>. Isso significa que os nossos computadores guardam apenas as casas decimais significantes de um valor <code>double</code>, e a perda de casas decimais que ocorre nesse processo, pode ser a fonte de alguma diferença em operações aritméticas. Por exemplo, se testarmos a igualdade entre <span class="math inline">\((\sqrt{2})^2 = 2\)</span>, o R vai nos indicar alguma diferença existente entre esses dois valores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">sqrt</span>(<span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">==</span> <span class="dv">2</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>Por essa razão, quando você estiver testando a igualdade entre valores do tipo <code>double</code>, é interessante que você utilize a função <code>near()</code> ao invés do operador <code>==</code>. Por padrão, a função <code>near()</code> possui uma tolerância próxima de <span class="math inline">\(1,49 \times 10^{-8}\)</span>, mas você pode ajustar esse valor pelo argumento <code>tol</code> da função.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">near</span>(<span class="fu">sqrt</span>(<span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>, <span class="dv">2</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>Para mais, você também deve estar atento ao uso do operador <code>==</code>, quando estiver testando a igualdade entre palavras, ou valores textuais. Pois uma palavra pode ser escrita de múltiplas maneiras sem que ela perca o seu sentido, e a mínima diferença presente nos caracteres utilizados pode torná-las valores completamente diferentes aos olhos do operador <code>==</code>. Logo, os valores <code>"Isabela"</code> e <code>"isabela"</code> são diferentes na visão de <code>==</code>, mesmo que na prática, esses valores muito provavelmente se referem ao mesmo indivíduo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="st">"Isabela"</span> <span class="sc">==</span> <span class="st">"isabela"</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>Se você possui em sua coluna, uma variedade maior de valores textuais, que são diferentes, mas que dizem respeito ao mesmo indivíduo (por exemplo, você possui seis variedades de “Isabela”: <code>Isabela</code>; <code>ISABELA</code>; <code>IsAbElA</code>; <code>Ísabela</code>; <code>ísabela</code>; <code>i\@abela</code>), você muito provavelmente necessita de uma expressão regular. Para acessar esse mecanismo e utilizá-lo dentro da função <code>filter()</code>, você precisa de uma função que utilize essa funcionalidade para pesquisar os textos que se encaixam em sua expressão, e que retorne como resultado, um vetor de valores lógicos que indicam as linhas de sua tabela em que esses textos ocorrem. Sendo os principais indivíduos dessa categoria, a função <code>grepl()</code>, e a função <code>str_detect()</code> que pertence ao pacote <code>stringr</code>.</p>
<p>Por outro lado, pode ser que você não precise ir tão longe, caso as diferenças presentes em seus textos se apresentem na forma de capitalização das letras (maiúsculo ou minúsculo). Por exemplo, suponha que a sua variedade de “Isabela” fosse: <code>Isabela</code>; <code>ISABELA</code>; <code>IsAbElA</code> e <code>isabela</code>. Para tornar esses valores iguais, você precisaria apenas de um método de pesquisa que seja capaz de ignorar a capitalização das letras. Para isso, você pode utilizar a função <code>grepl()</code> que possui o argumento <code>ignore.case</code>, no qual você pode pedir a função que ignore essas diferenças na capitalização, como no exemplo abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">usuario =</span> <span class="fu">c</span>(<span class="st">"Ana"</span>, <span class="st">"Isabela"</span>, <span class="st">"isabela"</span>, <span class="st">"Julia"</span>),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">4</span>), <span class="dv">2</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Isabela"</span>, usuario, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  usuario id valor
1 Isabela  2  0.18
2 isabela  3  1.59</code></pre>
</div>
</div>
</section>
<section id="estabelecendo-intervalos-com-a-função-between" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2" class="anchored" data-anchor-id="estabelecendo-intervalos-com-a-função-between"><span class="header-section-number">5.6.2</span> Estabelecendo intervalos com a função <code>between()</code></h3>
<p>Para estabelecermos uma condição de intervalo no R, precisamos de duas condições lógicas que definam os limites deste intervalo. Em seguida, nós devemos tornar essas duas condições dependentes. Por exemplo, se desejássemos filtrar todas as linhas de <code>mpg</code> que possuem um valor na coluna <code>hwy</code> entre 18 e 24, precisaríamos do seguinte teste lógico:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(hwy <span class="sc">&gt;=</span> <span class="dv">18</span>, hwy <span class="sc">&lt;=</span> <span class="dv">24</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> mpg<span class="sc">$</span>hwy <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> mpg<span class="sc">$</span>hwy <span class="sc">&lt;=</span> <span class="dv">24</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>mpg[clog, ]</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Porém, de uma maneira mais prática, podemos utilizar a função <code>between()</code> que consiste em um atalho para essa metodologia. A função possui três argumentos: 1) <code>x</code>, a coluna ou o vetor sobre o qual você deseja aplicar o teste de intervalo; 2) <code>left</code>, o limite “inferior” (ou “esquerdo”) do intervalo; 3) <code>right</code>, o limite “superior” (ou “direito”) do intervalo. Logo, se fôssemos traduzir o teste de intervalo anterior para a função <code>between()</code>, faríamos da seguinte maneira:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">between</span>(hwy, <span class="dv">18</span>, <span class="dv">24</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 63 × 11
  manufacturer model       displ  year   cyl trans drv     cty   hwy fl    class
  &lt;chr&gt;        &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
1 audi         a6 quattro    2.8  1999     6 auto… 4        15    24 p     mids…
2 audi         a6 quattro    4.2  2008     8 auto… 4        16    23 p     mids…
3 chevrolet    c1500 subu…   5.3  2008     8 auto… r        14    20 r     suv  
4 chevrolet    c1500 subu…   5.3  2008     8 auto… r        14    20 r     suv  
5 chevrolet    corvette      5.7  1999     8 auto… r        15    23 p     2sea…
# ℹ 58 more rows</code></pre>
</div>
</div>
</section>
<section id="sec:ataque_terrorista" class="level3" data-number="5.6.3">
<h3 data-number="5.6.3" class="anchored" data-anchor-id="sec:ataque_terrorista"><span class="header-section-number">5.6.3</span> Ataque terrorista</h3>
<p>Vamos dar um pouco de contexto para as nossas operações. Nessa seção, vamos utilizar os dados disponíveis na tabela <code>transf</code>, que podem ser importados para o seu R através dos comandos abaixo. A tabela <code>transf</code> contém informações sobre diversas transferências bancárias realizadas por uma instituição bancária. Algumas informações presentes nessa tabela incluem: a data e o horário da transferência (<code>Data</code>); O <em>username</em> do usuário do banco responsável por realizar a transferência (<code>Usuario</code>); o país de destino da transferência (<code>Pais</code>); um código de identificação da transferência (<code>TransferID</code>); e o valor transferido (<code>Valor</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/pedropark99/"</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">"Curso-R/master/Dados/"</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">"transf_reform.csv"</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>transf <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>transf</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20,006 × 6
  Data                Usuario  Valor TransferID Pais     Descricao
  &lt;dttm&gt;              &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
1 2018-12-06 22:19:19 Eduardo   599.  116241629 Alemanha NA       
2 2018-12-06 22:10:34 Júlio    4611.  115586504 Alemanha NA       
3 2018-12-06 21:59:50 Nathália 4418.  115079280 Alemanha NA       
4 2018-12-06 21:54:13 Júlio    2740.  114972398 Alemanha NA       
5 2018-12-06 21:41:27 Ana      1408.  116262934 Alemanha NA       
# ℹ 20,001 more rows</code></pre>
</div>
</div>
<p>Vamos supor que no dia 24 de dezembro de 2018, tenha ocorrido um ataque terrorista na cidade de Berlim (Alemanha). Suponha também, que você faz parte do setor de <em>compliance</em> da instituição financeira responsável pelas transferências descritas na tabela <code>transf</code>. Em geral, um dos principais papéis de um setor de <em>compliance</em> é garantir que a sua instituição não esteja contribuindo com práticas ilícitas (dentre elas está o terrorismo).</p>
<p>Segundo o relatório da polícia, há fortes indícios de que a munição utilizada no ato, foi comprada durante os dias 20 e 23. Além disso, a polícia também destacou que levando em conta a quantidade utilizada no ataque, somente a munição empregada custou em média mais de $15.000.</p>
<p>Logo, o seu papel seria se certificar de que a instituição a qual você pertence, não realizou alguma transferência que se encaixa nessas características. Pois caso tal transferência exista, vocês teriam de abrir uma investigação em conjunto com a polícia, para apurar as fontes e os destinatários dos recursos dessa transferência.</p>
<p>Portanto, estamos procurando por uma transferência na tabela <code>transf</code> de valor acima de $15.000, que possua a Alemanha como país de destino, e que tenha ocorrido durante os dias 20 e 23 de dezembro de 2018. Perceba que todas essas condições, ou características da transferência devem ser atendidas ao mesmo tempo. Ou seja, essas condições lógicas são dependentes uma da outra.</p>
<p>Lembre-se que quando temos diversas condições lógicas dependentes, nós podemos separá-las por vírgulas na função <code>filter()</code>. Por outro lado, fora do uso da função <code>filter()</code>, nós estabelecemos uma relação de dependência entre várias condições lógicas por meio do operador <code>&amp;</code>, e será esse o método tradicional utilizado nessa seção. Logo, quando temos diversas condições no R que devem ser atendidas ao mesmo tempo, nós devemos conectar cada uma dessas condições pelo operador <code>&amp;</code>, como no exemplo abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    Valor <span class="sc">&gt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> Pais <span class="sc">==</span> <span class="st">"Alemanha"</span> <span class="sc">&amp;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(<span class="fu">as.Date</span>(Data), <span class="fu">as.Date</span>(<span class="st">"2018-12-20"</span>), <span class="fu">as.Date</span>(<span class="st">"2018-12-23"</span>))</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 132 × 6
  Data                Usuario      Valor TransferID Pais     Descricao
  &lt;dttm&gt;              &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
1 2018-12-22 20:00:56 Armando     18521.  114513684 Alemanha NA       
2 2018-12-21 18:46:59 Júlio Cesar 16226.  116279014 Alemanha NA       
3 2018-12-21 17:41:48 Nathália    17583.  115748273 Alemanha NA       
4 2018-12-23 09:46:23 Júlio       15396.  115272184 Alemanha NA       
5 2018-12-21 06:38:20 Júlio Cesar 17555.  114983226 Alemanha NA       
# ℹ 127 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> transf<span class="sc">$</span>Valor <span class="sc">&gt;</span> <span class="dv">15000</span> <span class="sc">&amp;</span> transf<span class="sc">$</span>Pais <span class="sc">==</span> <span class="st">"Alemanha"</span> <span class="sc">&amp;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">between</span>(<span class="fu">as.Date</span>(transf<span class="sc">$</span>Data), <span class="fu">as.Date</span>(<span class="st">"2018-12-20"</span>), <span class="fu">as.Date</span>(<span class="st">"2018-12-23"</span>))</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>transf[clog, ]</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>No total, 132 linhas foram retornadas pela função, e você teria de conferir cada uma dessas transferências. Um baita trabalho! Porém, vamos supor que em um minuto de reflexão sobre as regras do banco, você se lembre que o remetente da transferência não é obrigado a apresentar uma prova de fundos ou um comprovante de endereço, caso a transferência possua um valor menor do que $200. Em casos como esse, o remetente precisa apresentar apenas a identidade (que ele pode ter falsificado).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    Valor <span class="sc">&lt;=</span> <span class="dv">200</span> <span class="sc">&amp;</span> Pais <span class="sc">==</span> <span class="st">"Alemanha"</span> <span class="sc">&amp;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(<span class="fu">as.Date</span>(Data), <span class="fu">as.Date</span>(<span class="st">"2018-12-20"</span>), <span class="fu">as.Date</span>(<span class="st">"2018-12-23"</span>))</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 6
  Data                Usuario Valor TransferID Pais     Descricao
  &lt;dttm&gt;              &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
1 2018-12-20 00:31:17 Júlio     193  115555598 Alemanha NA       
2 2018-12-22 06:30:01 Sandra    100  116400001 Alemanha NA       
3 2018-12-22 06:35:00 Sandra    200  116400002 Alemanha NA       
4 2018-12-22 06:42:12 Eduardo   200  116400005 Alemanha NA       
5 2018-12-22 06:55:54 Eduardo   150  116400009 Alemanha NA       </code></pre>
</div>
</div>
<p>Isso é interessante, pois conseguimos reduzir os nossos resultados para apenas 5 transferências. Ao conferirmos as informações da primeira transferência, os recursos estão limpos. Porém, as próximas 4 transferências levantam algumas suspeitas. Pois elas foram realizadas por clientes diferentes, mas com poucos minutos de diferença. Ao conversar com os agentes Sandra e Eduardo, que autorizaram essas transferências, você descobre que todos os diferentes clientes apresentaram documentos de identidade franceses. Será que esses clientes estavam testando as regras da instituição para com identidades desse país?</p>
<p>Ao procurar por todas as transferências em que identidades francesas foram apresentadas, e que foram realizadas entre os dias 20 e 23 de dezembro de 2018, e que possuíam a Alemanha como país de destino, você chega a uma estranha transferência de $20.000 efetuada poucos minutos depois das 4 transferências que encontramos anteriormente. Durante a análise das informações dessa transferência, você percebe diversas falhas presentes na prova de fundos que sustentou a decisão de autorização dessa operação. Há uma grande possibilidade de que os chefes e agentes de sua instituição que autorizaram essa operação, estejam em maus lençóis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    identidade,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"TransferID"</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    Pais <span class="sc">==</span> <span class="st">"Alemanha"</span> <span class="sc">&amp;</span> Identi_Nacion <span class="sc">==</span> <span class="st">"França"</span> <span class="sc">&amp;</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">between</span>(<span class="fu">as.Date</span>(Data), <span class="fu">as.Date</span>(<span class="st">"2018-12-20"</span>), <span class="fu">as.Date</span>(<span class="st">"2018-12-23"</span>))</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  Data                Usuario Valor TransferID Pais     Descricao Identi_Nacion
  &lt;dttm&gt;              &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;     &lt;chr&gt;        
1 2018-12-22 06:30:01 Sandra    100  116400001 Alemanha NA        França       
2 2018-12-22 06:35:00 Sandra    200  116400002 Alemanha NA        França       
3 2018-12-22 06:42:12 Eduardo   200  116400005 Alemanha NA        França       
4 2018-12-22 06:55:54 Eduardo   150  116400009 Alemanha NA        França       
5 2018-12-22 06:59:07 Eduardo 20000  116400010 Alemanha NA        França       </code></pre>
</div>
</div>
</section>
<section id="condições-dependentes-ou-independentes" class="level3" data-number="5.6.4">
<h3 data-number="5.6.4" class="anchored" data-anchor-id="condições-dependentes-ou-independentes"><span class="header-section-number">5.6.4</span> Condições dependentes (&amp;) ou independentes (|) ?</h3>
<p>Na seção anterior, as condições lógicas que guiavam o nosso filtro eram dependentes entre si. Em outras palavras, as condições deveriam ser todas atendidas ao mesmo tempo. Por essa razão, nós conectamos as condições lógicas com o operador <code>&amp;</code>. Porém, em algumas ocasiões as suas condições serão independentes e, por isso, devemos utilizar um outro operador para conectá-las, que é a barra vertical (<code>|</code>).</p>
<p>Por exemplo, se eu quiser encontrar todas as transferências na tabela <code>transf</code> que ocorreram no dia 13 de novembro de 2018, <strong>ou</strong> que possuem um valor menor que $500, <strong>ou</strong> que foram autorizadas pelo agente Eduardo, eu devo construir o comando abaixo. Logo, toda linha da tabela <code>transf</code> que atenda pelo menos uma das condições que estabelecemos, é filtrada pela função <code>filter()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.Date</span>(Data) <span class="sc">==</span> <span class="fu">as.Date</span>(<span class="st">"2018-11-13"</span>) <span class="sc">|</span> Valor <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">|</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    Usuario <span class="sc">==</span> <span class="st">"Eduardo"</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,581 × 6
  Data                Usuario      Valor TransferID Pais     Descricao
  &lt;dttm&gt;              &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;lgl&gt;    
1 2018-12-06 22:19:19 Eduardo       599.  116241629 Alemanha NA       
2 2018-12-06 20:54:32 Eduardo      5665.  114830203 Alemanha NA       
3 2018-12-06 19:07:50 Eduardo      9561.  115917812 Alemanha NA       
4 2018-12-06 18:09:15 Júlio Cesar   388.  114894102 Alemanha NA       
5 2018-12-06 16:59:38 Eduardo     11759.  115580064 Alemanha NA       
# ℹ 5,576 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="do">## A mesma operação por subsetting:</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>clog <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(transf<span class="sc">$</span>Data) <span class="sc">==</span> <span class="fu">as.Date</span>(<span class="st">"2018-11-13"</span>) <span class="sc">|</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  transf<span class="sc">$</span>Valor <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">|</span> transf<span class="sc">$</span>Usuario <span class="sc">==</span> <span class="st">"Eduardo"</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>transf[clog, ]</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="ordenando-linhas-com-arrange" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="ordenando-linhas-com-arrange"><span class="header-section-number">5.7</span> Ordenando linhas com <code>arrange()</code></h2>
<p>Algumas operações que realizamos dependem diretamente da forma como as linhas de nossa tabela estão ordenadas. Em outros momentos, desejamos ordenar a nossa tabela, para rapidamente identificarmos as observações que possuem os 10 maiores valores de alguma variável ao longo da base. Ou seja, a ordenação de linhas é uma operação muito comum, e o pacote <code>dplyr</code> oferece a função <code>arrange()</code> para tal ação.</p>
<p>O uso da função <code>arrange()</code> é bem simples. Tudo o que você precisa fazer é listar as colunas pelas quais você deseja ordenar a base. Caso a coluna seja numérica, <code>arrange()</code> vai seguir uma ordenação numérica. Mas se essa coluna for do tipo <code>character</code>, <code>arrange()</code> vai utilizar uma ordenação alfabética para organizar os valores da coluna. Por outro lado, na hipótese dessa coluna ser do tipo <code>factor</code>, <code>arrange()</code> vai seguir a ordem presente nos “níveis” (<code>levels</code>) desse <code>factor</code>, aos quais você pode acessar pela função <code>levels()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(displ)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 11
  manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
  &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
1 honda        civic   1.6  1999     4 manual(m5) f        28    33 r     subco…
2 honda        civic   1.6  1999     4 auto(l4)   f        24    32 r     subco…
3 honda        civic   1.6  1999     4 manual(m5) f        25    32 r     subco…
4 honda        civic   1.6  1999     4 manual(m5) f        23    29 p     subco…
5 honda        civic   1.6  1999     4 auto(l4)   f        24    32 r     subco…
# ℹ 229 more rows</code></pre>
</div>
</div>
<p>Você pode recorrer a várias colunas para ordenar a sua base. Nessa situação, a função <code>arrange()</code> vai ordenar as colunas na ordem em que você as definiu na função. Ou seja, no exemplo abaixo, a função <code>arrange()</code> primeiro ordena a base de acordo com a coluna <code>displ</code>, em seguida, segundo a coluna <code>hwy</code>, e por último, a coluna <code>trans</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(displ, hwy, trans)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 11
  manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
  &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
1 honda        civic   1.6  1999     4 manual(m5) f        23    29 p     subco…
2 honda        civic   1.6  1999     4 auto(l4)   f        24    32 r     subco…
3 honda        civic   1.6  1999     4 auto(l4)   f        24    32 r     subco…
4 honda        civic   1.6  1999     4 manual(m5) f        25    32 r     subco…
5 honda        civic   1.6  1999     4 manual(m5) f        28    33 r     subco…
# ℹ 229 more rows</code></pre>
</div>
</div>
<p>Por padrão, a função <code>arrange()</code> utiliza uma ordenação em um sentido crescente (do menor para o maior valor; do primeiro para o último valor), qualquer que seja o tipo de dado contido na coluna que você forneceu a função. Caso você deseja utilizar uma ordenação em um sentido decrescente (do maior para o menor valor; do último para o primeiro valor) em uma dada coluna, você deve encapsular o nome dessa coluna na função <code>desc()</code>. No exemplo abaixo, <code>arrange()</code> primeiro ordena a coluna <code>manufacturer</code> em uma forma decrescente e, em seguida, ordena a coluna <code>hwy</code> de acordo com uma ordem crescente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(manufacturer), hwy)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 11
  manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
  &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
1 volkswagen   jetta   2.8  1999     6 auto(l4)   f        16    23 r     compa…
2 volkswagen   gti     2.8  1999     6 manual(m5) f        17    24 r     compa…
3 volkswagen   jetta   2.8  1999     6 manual(m5) f        17    24 r     compa…
4 volkswagen   gti     2    1999     4 auto(l4)   f        19    26 r     compa…
5 volkswagen   jetta   2    1999     4 auto(l4)   f        19    26 r     compa…
# ℹ 229 more rows</code></pre>
</div>
</div>
<p>Como estamos basicamente definindo colunas na função <code>arrange()</code>, é natural que você anseie pelos diversos métodos de seleção que aprendemos em <code>select()</code>. Por isso, em versões mais recentes do pacote <code>dplyr</code> tivemos a introdução da função <code>across()</code>, pela qual você tem novamente acesso a todos esses métodos que vimos em <code>select()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Ordenar a base segundo as três primeiras colunas</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">across</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Ordenar a base segundo o conjunto de colunas</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="do">## que possuem um nome que se inicia</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="do">## pelos caracteres "dis"</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"dis"</span>)))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vale destacar que a função <code>arrange()</code>, por padrão, não respeita os grupos de sua tabela e, portanto, considera toda a sua tabela no momento em que a ordenação ocorre. Ainda veremos em mais detalhes nas próximas seções, a função <code>group_by()</code>, pela qual você pode definir os grupos presentes em sua tabela. Portanto, pode ser de seu desejo que a ordenação executada por <code>arrange()</code> ocorra dentro de cada um dos grupos que você delimitou através da função <code>group_by()</code>. Para isso, você precisa configurar o argumento <code>.by_group</code> para <code>TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(manufacturer) <span class="sc">%&gt;%</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(hwy, <span class="at">.by_group =</span> <span class="cn">TRUE</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 11
# Groups:   manufacturer [15]
  manufacturer model      displ  year   cyl trans  drv     cty   hwy fl    class
  &lt;chr&gt;        &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
1 audi         a6 quattro   4.2  2008     8 auto(… 4        16    23 p     mids…
2 audi         a6 quattro   2.8  1999     6 auto(… 4        15    24 p     mids…
3 audi         a4 quattro   1.8  1999     4 auto(… 4        16    25 p     comp…
4 audi         a4 quattro   2.8  1999     6 auto(… 4        15    25 p     comp…
5 audi         a4 quattro   2.8  1999     6 manua… 4        17    25 p     comp…
# ℹ 229 more rows</code></pre>
</div>
</div>
</section>
<section id="sec:mutate_dplyr" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="sec:mutate_dplyr"><span class="header-section-number">5.8</span> Adicionando variáveis à sua tabela com <code>mutate()</code></h2>
<p>Já aprendemos muitas coisas sobre como trabalhar com as colunas que já existem em nossa tabela. Mas e se precisamos de adicionar novas colunas a essa tabela? Se precisamos calcular novas variáveis para essa tabela? Como podemos fazer isso? Para isso, o pacote <code>dplyr</code> disponibiliza a função <code>mutate()</code>.</p>
<p>Essa função funciona da mesma forma que o método <code>with_columns()</code> do framework <code>polars</code>, e também, ao método <code>withColumns()</code> do Apache Spark. Em resumo, você fornece uma lista de expressões a essa função. Cada expressão é responsável por criar uma nova coluna separada em sua tabela.</p>
<p>Como um exemplo inicial, vamos voltar a tabela <code>transf</code> que introduzimos na seção <a href="#sec:ataque_terrorista">Ataque terrorista</a>. A coluna <code>Data</code> contém a data e o horário em que cada operação foi registrada no sistema do banco. Entretanto, o horário pode se tornar irrelevante para certos passos e, por essa razão, pode ser interessante conter uma nova coluna que contém apenas a data de cada transferência. Com esse objetivo em mente, podemos extrair a data da coluna <code>Data</code> através da função <code>as.Date()</code>, e empregar a função <code>mutate()</code> para armazenarmos o resultado desse procedimento em uma nova coluna chamada <code>Sem_hora</code>, como mostrado abaixo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Pais, <span class="sc">-</span>Descricao) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sem_hora =</span> <span class="fu">as.Date</span>(Data)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20,006 × 5
  Data                Usuario  Valor TransferID Sem_hora  
  &lt;dttm&gt;              &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;date&gt;    
1 2018-12-06 22:19:19 Eduardo   599.  116241629 2018-12-06
2 2018-12-06 22:10:34 Júlio    4611.  115586504 2018-12-06
3 2018-12-06 21:59:50 Nathália 4418.  115079280 2018-12-06
4 2018-12-06 21:54:13 Júlio    2740.  114972398 2018-12-06
5 2018-12-06 21:41:27 Ana      1408.  116262934 2018-12-06
# ℹ 20,001 more rows</code></pre>
</div>
</div>
<p>Portanto, sempre que você recorrer à função <code>mutate()</code>, você deve compor essa estrutura de <code>&lt;nome_coluna&gt; = &lt;expressao&gt;</code> em cada coluna adicionada. Ou seja, como flexibilidade e eficiência são valores que as funções do pacote <code>dplyr</code> carregam, você tem a capacidade de criar múltiplas colunas em um único <code>mutate()</code>. Porém, como um aviso, é ideal que você não crie mais de 7 colunas ao mesmo tempo, pois há uma probabilidade de você enfrentar problemas de memória e mensagens de erro bastante nebulosas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Estrutura básica de um mutate():</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&lt;</span>sua_tabela<span class="sc">&gt;</span> <span class="sc">%&gt;%</span> </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nome_coluna1 =</span> expressao1,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">nome_coluna2 =</span> expressao2,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">nome_coluna3 =</span> expressao3,</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Um outro ponto muito importante, é que em um mesmo <code>mutate()</code>, você também pode empregar uma nova coluna que você acabou de criar, no cálculo de uma outra coluna a ser produzida em sequência. Por exemplo, eu posso guardar o desvio de <code>Valor</code> em relação à sua média, na coluna <code>Desvio</code>, e logo em seguida, utilizar os valores desta nova coluna para produzir uma outra coluna chamada <code>Valor_norm</code>, como exposto abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>transf <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Pais, <span class="sc">-</span>Descricao) <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Desvio =</span> Valor <span class="sc">-</span> <span class="fu">mean</span>(Valor),</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Valor_norm =</span> Desvio <span class="sc">/</span> <span class="fu">sd</span>(Valor)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20,006 × 6
  Data                Usuario  Valor TransferID Desvio Valor_norm
  &lt;dttm&gt;              &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
1 2018-12-06 22:19:19 Eduardo   599.  116241629 -2920.     -0.772
2 2018-12-06 22:10:34 Júlio    4611.  115586504  1093.      0.289
3 2018-12-06 21:59:50 Nathália 4418.  115079280   900.      0.238
4 2018-12-06 21:54:13 Júlio    2740.  114972398  -778.     -0.206
5 2018-12-06 21:41:27 Ana      1408.  116262934 -2110.     -0.558
# ℹ 20,001 more rows</code></pre>
</div>
</div>
<p>Com isso, a parte fundamental de um <code>mutate()</code> é construirmos a expressão que produzirá os valores a serem alocados na nova coluna que estamos criando. Logo abaixo, consta uma lista de várias funções que você pode utilizar para formar a expressão que você deseja. Essa é uma lista parcial, logo, há diversas outras funções que você pode utilizar para calcular os valores dos quais você necessita.</p>
<ol type="1">
<li><p><strong>Somatórios:</strong> soma total de uma coluna - <code>sum()</code>; somatório por linha, ao longo de algumas colunas - operador <code>+</code>; somatório por linha, ao longo de várias colunas - <code>rowSums()</code>.</p></li>
<li><p><strong>Operações cumulativas:</strong> somatório acumulado de uma coluna - <code>cumsum()</code>; média acumulada de uma coluna - <code>cummean()</code>; mínimo acumulado de uma coluna - <code>cummin()</code>; máximo acumulado de uma coluna - <code>cummax()</code>.</p></li>
<li><p><strong>Medidas de posição:</strong> média de uma coluna - <code>mean()</code>; mediana de uma coluna - <code>median()</code>; média por linha, ao longo de várias colunas - <code>rowMeans()</code>; média móvel - <code>roll_mean()</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p></li>
<li><p><strong>Medidas de dispersão:</strong> desvio padrão de uma coluna - <code>sd()</code>; variância de uma coluna - <code>var()</code>; intervalo interquartil - <code>IQR()</code>; desvio absoluto da mediana - <code>mad()</code>.</p></li>
<li><p><strong>Operadores aritméticos:</strong> soma (<code>+</code>); subtração (<code>-</code>); divisão (<code>/</code>); multiplicação (<code>*</code>); potência, ou elevar um número a <code>x</code> (<code>^</code>); restante da divisão (<code>%%</code>); apenas o número inteiro resultante da divisão (<code>%/%</code>); logaritmo - <code>log()</code>.</p></li>
<li><p><strong>Operadores lógicos:</strong> aplique um teste lógico em cada linha, e preencha essa linha com <code>x</code> caso o teste resulte em <code>TRUE</code>, ou preencha com <code>y</code> caso o teste resulte em <code>FALSE</code> - <code>if_else()</code>; quando você quer aplicar uma operação parecida com <code>if_else()</code>, mas que há vários casos possíveis, um exemplo típico seria criar uma coluna de faixas etárias - <code>case_when()</code>; você também pode utilizar normalmente todos os operadores que vimos na seção de <code>filter()</code>, para criar um teste lógico sobre cada linha - <code>&lt;, &lt;=, &gt;, &gt;=, ==, !=, !, &amp;, |</code>.</p></li>
<li><p><strong>Funções para discretizar variáveis contínuas:</strong> calcula intervalos de forma a encaixar o mesmo número de observações em cada intervalo (comumente chamados de quantis) - <code>cut_number()</code>; calcula intervalos com o mesmo alcance - <code>cut_interval()</code>; calcula intervalos de largura definida no argumento <code>width</code> - <code>cut_width()</code>.</p></li>
<li><p><strong>Funções de defasagem e liderança:</strong> quando você precisa em algum cálculo naquela linha, utilizar o valor da linha anterior - <code>lag()</code>; ou ao invés do valor da linha anterior, você precisa do valor da linha posterior - <code>lead()</code>.</p></li>
</ol>
<p>Porém, é necessário ter cautela. Como a função <code>mutate()</code> busca trabalhar com <code>data.frame</code>’s, é de suma importância, que você esteja sempre consciente das propriedades que essa estrutura carrega. Em especial, a propriedade de que as suas colunas devem possuir o mesmo número de elementos. Portanto, se o seu <code>data.frame</code> possui exatamente 10 mil linhas, você precisa se certificar de que cada expressão utilizada na função <code>mutate()</code>, vai gerar 10 mil elementos como resultado.</p>
<p>Na hipótese de que alguma dessas expressões produzam, por exemplo, 9.999 elementos, um erro será acionado, pois esses 9,999 mil elementos não podem ser guardados em um <code>data.frame</code> que possui 10 mil linhas. Logo, a função <code>mutate()</code> lhe provê flexibilidade e eficiência, mas ela não é capaz de quebrar regras fundamentais da linguagem R.</p>
<p>Um exemplo prático disso é encontrado quando tentamos calcular uma média móvel de alguma série temporal, ou de algum valor diário utilizando a função <code>mutate()</code>, como no exemplo abaixo. O erro ocorre devido a própria natureza do cálculo de uma média móvel, que gera uma “perda” de observações, e como consequência, um número menor de observações é gerado dentro do resultado. Perceba abaixo, que ao aplicarmos uma janela de cálculo de 5 observações, a função <code>roll_mean()</code> foi capaz de produzir 996 valores, consequentemente, perdemos 4 observações no processo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RcppRoll)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_movel =</span> <span class="fu">roll_mean</span>(df<span class="sc">$</span>valor, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Error in `mutate()`:
ℹ In argument: `media_movel = roll_mean(df$valor, n = 5)`.
Caused by error:
! `media_movel` must be size 1000 or 1, not 996.</code></pre>
<p>Compreendendo essa característica do cálculo de uma média móvel, a função <code>roll_mean()</code> oferece o argumento <code>fill</code>, no qual podemos pedir à função que complete as observações restantes com zeros, como no exemplo abaixo. Dessa forma, a função volta a produzir 1000 observações em seu resultado e, consequentemente, nenhum erro é acionado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_movel =</span> <span class="fu">roll_mean</span>(valor, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="dv">0</span>, <span class="at">align =</span> <span class="st">"right"</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 3
    dia  valor media_movel
  &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
1     1 -0.626       0    
2     2  0.184       0    
3     3 -0.836       0    
4     4  1.60        0    
5     5  0.330       0.129
# ℹ 995 more rows</code></pre>
</div>
</div>
<p>Desse modo, estamos discutindo as possibilidades existentes de sua expressão fornecida à <code>mutate()</code>, produzir múltiplos valores. Todavia, diversas funções extremamente úteis, e que utilizamos com bastante frequência nessas expressões, resultam apenas em um único valor. Grandes exemplos são as funções <code>mean()</code> e <code>sum()</code>, que calculam a média e a soma de uma coluna, respectivamente.</p>
<p>Em todas as ocasiões em que a sua expressão na função <code>mutate()</code> gerar um único valor, qualquer que ele seja, a função <code>mutate()</code> irá automaticamente replicar esse mesmo valor ao longo de toda a coluna que você acaba de criar. Vemos uma demonstração disso, ao criarmos abaixo, as colunas <code>soma</code>, <code>prop</code> e <code>um_numero</code>. Com essa ideia em mente, se temos diversos valores numéricos em uma dada coluna, nós podemos eficientemente calcular uma proporção desses valores em relação ao total de sua coluna, com o uso da função <code>sum()</code>, como no exemplo abaixo. Da mesma forma, nós podemos rapidamente normalizar uma coluna numérica segundo a fórmula de uma estatística Z, por meio das funções <code>sd()</code> e <code>mean()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">1.5</span>, <span class="fl">3.2</span>, <span class="fl">5.1</span>, <span class="fl">2.2</span>),</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">soma =</span> <span class="fu">sum</span>(x),</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop =</span> y <span class="sc">*</span> <span class="dv">100</span> <span class="sc">/</span> <span class="fu">sum</span>(y),</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">um_numero =</span> <span class="dv">25</span>,</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">norm =</span> (x <span class="sc">-</span> <span class="fu">mean</span>(x)) <span class="sc">/</span> <span class="fu">sd</span>(x)</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
     id     x     y  soma  prop um_numero   norm
  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;
1     1   2.5     1  14.5  6.67        25 -0.291
2     2   1.5     2  14.5 13.3         25 -1.02 
3     3   3.2     3  14.5 20           25  0.219
4     4   5.1     4  14.5 26.7         25  1.60 
5     5   2.2     5  14.5 33.3         25 -0.510</code></pre>
</div>
</div>
</section>
<section id="sec:group_by_summarise" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="sec:group_by_summarise"><span class="header-section-number">5.9</span> Agrupando dados com <code>group_by()</code> e gerando estatísticas sumárias com <code>summarise()</code></h2>
<p>Em diversas áreas é muito comum encontramos variáveis qualitativas nas bases de dados. Variáveis desse tipo, usualmente definem grupos ou estratos de uma amostra, população ou medida, como faixas etárias ou faixas de valor salarial. Se você está analisando, por exemplo, dados epidemiológicos, você em geral deseja examinar se uma dada doença está ocorrendo com maior ou menor intensidade em um determinado grupo de sua população.</p>
<p>Ou seja, será que fatores como a cor de pele, a idade, o gênero, a orientação sexual ou a localidade de um indivíduo são capazes de afetar as suas chances de ser infectado por essa doença? De outra maneira, será que essas variáveis qualitativas são capazes de gerar, por exemplo, diferenças no salário deste indivíduo? Da mesma forma, quando analisamos a performance de determinadas firmas, desejamos saber se a localidade, o setor, o tamanho, o investimento e a receita total, além do número de funcionários dessa firma são capazes de prover alguma vantagem em relação aos seus concorrentes.</p>
<p>Para esse tipo de estudo, o pacote <code>dplyr</code> nos oferece a função <code>group_by()</code> que fundamentalmente altera o comportamento de funções como <code>mutate()</code> e <code>summarise()</code>, e nos permite calcular estatísticas e aplicarmos operações dentro de cada grupo presente em nossos dados. Ou seja, você geralmente usa <code>group_by()</code> em conjunto com outras funções do pacote. Como um exemplo inicial, vamos utilizar a tabela <code>minas_pop</code>, que contém dados de população e PIB (Produto Interno Bruto) dos 853 municípios do estado de Minas Gerais.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/pedropark99/"</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">"Curso-R/master/Dados/"</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">"populacao.csv"</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>minas_pop <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>minas_pop</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 853 × 7
  IBGE2   IBGE Munic               Populacao   Ano      PIB Intermediaria
  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        
1    10 310010 Abadia dos Dourados      6972  2017 33389769 Uberlândia   
2    20 310020 Abaeté                  23223  2017 96201158 Divinópolis  
3    30 310030 Abre Campo              13465  2017 29149429 Juíz de Fora 
4    40 310040 Acaiaca                  3994  2017  2521892 Juíz de Fora 
5    50 310050 Açucena                  9575  2017 15250077 Ipatinga     
# ℹ 848 more rows</code></pre>
</div>
</div>
<p>Como demonstramos na seção anterior, a função <code>sum()</code> calcula a soma total de uma coluna. Logo, se aplicássemos a função <code>sum()</code> sobre a coluna <code>Populacao</code>, teríamos a população total do estado de Minas Gerais. Porém, e se desejássemos calcular a população total de cada uma das regiões intermediárias (presentes na coluna <code>Intermediaria</code>) que compõe o estado de Minas Gerais?</p>
<p>Para isso, nós podemos utilizar a função <code>group_by()</code> para determinar onde em nossa tabela se encontram os grupos de nossos dados. No nosso caso, esses grupos estão na coluna <code>Intermediaria</code>. Dessa forma, após utilizarmos o <code>group_by()</code>, perceba abaixo que os totais calculados pela função <code>sum()</code>, e que estão apresentados na coluna <code>Pop_total</code>, variam ao longo da tabela de acordo com o valor presente na coluna <code>Intermediaria</code>. Logo, temos agora a população total de cada região intermediária na coluna <code>Pop_total</code>. Da mesma maneira, ao invés de possuírmos uma proporção baseada na população do estado, as proporções de cada município expostas na coluna <code>Prop_pop_mun</code> possuem como denominador, a população total da região intermediária a qual o município pertence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>minas_pop <span class="sc">%&gt;%</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Ano, <span class="sc">-</span>PIB) <span class="sc">%&gt;%</span> </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Intermediaria) <span class="sc">%&gt;%</span> </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Pop_total =</span> <span class="fu">sum</span>(Populacao),</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Prop_pop_mun =</span> Populacao <span class="sc">*</span> <span class="dv">100</span> <span class="sc">/</span> Pop_total</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 853 × 7
# Groups:   Intermediaria [13]
  IBGE2   IBGE Munic              Populacao Intermediaria Pop_total Prop_pop_mun
  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;        &lt;dbl&gt;
1    10 310010 Abadia dos Dourad…      6972 Uberlândia      1161513        0.600
2    20 310020 Abaeté                 23223 Divinópolis     1300658        1.79 
3    30 310030 Abre Campo             13465 Juíz de Fora    2334530        0.577
4    40 310040 Acaiaca                 3994 Juíz de Fora    2334530        0.171
5    50 310050 Açucena                 9575 Ipatinga        1022384        0.937
# ℹ 848 more rows</code></pre>
</div>
</div>
<p>Para verificarmos se os grupos em uma dada tabela estão definidos, podemos observar se a descrição <code>Groups</code> se encontra logo abaixo às dimensões da tabela (<code>tibble: 853 x 7</code>). Essa descrição <code>Groups</code>, acaba nos informando a coluna (ou o conjunto de colunas) envolvidas nessa definição, além do número de grupos que estão contidos em nossa tabela. Logo, pelo resultado do exemplo acima, temos 13 grupos, ou 13 regiões intermediárias diferentes presentes na coluna <code>Intermediaria</code>.</p>
<p>Como um outro exemplo, dessa vez, em um contexto relativamente atual, podemos utilizar os dados de COVID-19 presentes na tabela abaixo, denominada <code>covid</code>. Nessa tabela, temos o acumulado do número de casos confirmados do vírus em cada estado brasileiro, durante o período de 25 de Fevereiro a 27 de Julho de 2020.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>github <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/pedropark99/"</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>pasta <span class="ot">&lt;-</span> <span class="st">"Curso-R/master/Dados/"</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>arquivo <span class="ot">&lt;-</span> <span class="st">"covid.csv"</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>covid <span class="ot">&lt;-</span> <span class="fu">read_csv2</span>(<span class="fu">paste0</span>(github, pasta, arquivo))</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>covid</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,625 × 4
  data       estado casos mortes
  &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 2020-03-17 AC         3      0
2 2020-03-18 AC         3      0
3 2020-03-19 AC         4      0
4 2020-03-20 AC         7      0
5 2020-03-21 AC        11      0
# ℹ 3,620 more rows</code></pre>
</div>
</div>
<p>Portanto, uma atividade muito comum com os dados da COVID-19, seria calcularmos a variação diária no número de casos acumulados. Tal cálculo pode ser atingido, através dos valores acumulados na coluna <code>casos</code>, ao subtrairmos do valor da linha corrente, o valor da linha anterior nessa mesma coluna. Para incluirmos o valor da linha anterior em nosso cálculo, podemos usar a função <code>lag()</code>, como no código abaixo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>covid <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">casos_var =</span> casos <span class="sc">-</span> <span class="fu">lag</span>(casos),</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortes_var =</span> mortes <span class="sc">-</span> <span class="fu">lag</span>(mortes)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Porém, temos um problema nessa operação, que emerge do fato de que não delimitamos os grupos da tabela. Sem esses grupos definidos, a função <code>mutate()</code> vai aplicar a expressão <code>casos - lag(casos)</code> sobre toda a tabela de uma vez só. O correto, seria que nós aplicássemos essa operação separadamente sobre os dados de cada estado.</p>
<p>Dito de outra forma, ao não dizermos que cada estado deveria ser tratado de forma separada dos demais, estamos invadindo os limites de cada estado com o cálculo pertencente a outros estados. Em outras palavras, o problema que emerge do código anterior, em que não definimos os grupos, se encontra nas linhas que definem os limites entre cada estado, ou as linhas que marcam a transição entre os dados do estado A para os dados do estado B. Logo, caso não definirmos esses grupos, estaremos utilizando no cálculo da variação presente na primeira linha referente ao estado de São Paulo, o número acumulado de casos localizado na última linha pertencente ao estado que vem antes de São Paulo na base (o estado de Sergipe).</p>
<p>Por isso, ao utilizarmos a função <code>group_by()</code> sobre a tabela <code>covid</code>, faremos com que a função <code>mutate()</code> esteja consciente dos limites entre os dados de cada estado, e que, portanto, respeite esses limites durante o cálculo dessa variação.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>covid_novo <span class="ot">&lt;-</span> covid <span class="sc">%&gt;%</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estado) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">casos_var =</span> casos <span class="sc">-</span> <span class="fu">lag</span>(casos),</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mortes_var =</span> mortes <span class="sc">-</span> <span class="fu">lag</span>(mortes)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>covid_novo </span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,625 × 6
# Groups:   estado [27]
  data       estado casos mortes casos_var mortes_var
  &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 2020-03-17 AC         3      0        NA         NA
2 2020-03-18 AC         3      0         0          0
3 2020-03-19 AC         4      0         1          0
4 2020-03-20 AC         7      0         3          0
5 2020-03-21 AC        11      0         4          0
# ℹ 3,620 more rows</code></pre>
</div>
</div>
<p>Agora que vimos a função <code>group_by()</code>, podemos prosseguir para a função <code>summarise()</code>, que busca sumarizar, sintetizar ou reduzir múltiplos valores de seu <code>data.frame</code> em poucas linhas. Logo, se eu aplicar a função <code>summarise()</code> sobre a tabela <code>minas_pop</code>, um novo <code>data.frame</code> será gerado, e ele irá conter provavelmente uma única linha. O seu trabalho é definir os valores que vão ocupar essa única linha.</p>
<p>Por isso, dentro da função <code>summarise()</code>, devemos fornecer expressões, exatamente da mesma forma que fornecemos em <code>mutate()</code>. Essas expressões vão ser responsáveis por calcular os valores que vão preencher as linhas presentes no novo <code>data.frame</code> criado. Contudo, ao invés de retornar múltiplos valores, essas expressões delineadas por você devem retornar um único valor ou uma única estatística sumária, de modo que o novo <code>data.frame</code> resultante de <code>summarise()</code> vai possuir uma única linha, e uma coluna para cada expressão definida. Como exemplo, podemos calcular o somatório total e a média da coluna <code>Populacao</code> da seguinte forma:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>minas_pop <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="fu">sum</span>(Populacao),</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_pop =</span> <span class="fu">mean</span>(Populacao)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  total_pop media_pop
      &lt;dbl&gt;     &lt;dbl&gt;
1  21040662    24667.</code></pre>
</div>
</div>
<p>Apesar dessas características, a função <code>summarise()</code> é normalmente utilizada em conjunto com a função <code>group_by()</code>. Pois ao definirmos os grupos de nossa tabela, a função <code>summarise()</code> passa a produzir uma linha para cada grupo presente em nossa tabela. Logo, o cálculo da população total e da população média anterior, que antes produzia uma única linha, passa a gerar 13 valores diferentes e, portanto, 13 linhas diferentes ao agruparmos os dados de acordo com a coluna <code>Intermediaria</code>. Podemos ainda aplicar a função <code>n()</code>, com o objetivo de descobrirmos quantas linhas, ou quantos municípios representam cada região intermediária do estado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>minas_pop <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Intermediaria) <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop =</span> <span class="fu">sum</span>(Populacao),</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_pop =</span> <span class="fu">mean</span>(Populacao),</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">numero_municipios =</span> <span class="fu">n</span>()</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 4
  Intermediaria        total_pop media_pop numero_municipios
  &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;             &lt;int&gt;
1 Barbacena               772694    15769.                49
2 Belo Horizonte         6237890    84296.                74
3 Divinópolis            1300658    21322.                61
4 Governador Valadares    771775    13306.                58
5 Ipatinga               1022384    23236                 44
# ℹ 8 more rows</code></pre>
</div>
</div>
<p>Neste momento, vale a pena comentar também, sobre a função <code>count()</code>, que se traduz como um atalho para a junção das funções <code>group_by()</code>, <code>summarise()</code> e <code>n()</code>. Logo, ao invés de construirmos toda a estrutura de <code>group_by()</code> e <code>summarise()</code>, nós poderíamos rapidamente contabilizar o número de municípios em cada região intermediária, através da função <code>count()</code>, como no exemplo abaixo. Lembrando que cada coluna fornecida à <code>count()</code>, será repassada a <code>group_by()</code> e, portanto, será responsável por definir os grupos nos quais a contagem será aplicada. Logo, se definíssemos a função como <code>count(minas_pop, Intermediaria, Ano)</code>, estaríamos calculando o número de municípios existentes em cada região intermediária, dentro de um dado ano descrito em nossa tabela.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>minas_pop <span class="sc">%&gt;%</span> <span class="fu">count</span>(Intermediaria)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 2
  Intermediaria            n
  &lt;chr&gt;                &lt;int&gt;
1 Barbacena               49
2 Belo Horizonte          74
3 Divinópolis             61
4 Governador Valadares    58
5 Ipatinga                44
# ℹ 8 more rows</code></pre>
</div>
</div>
<p>Para além desses pontos, vale destacar que certos momentos em que você necessita de várias colunas para identificar um único grupo de sua tabela, não são incomuns. Por isso, você pode incluir mais de uma coluna dentro da função <code>group_by()</code>. Por exemplo, suponha que você possua na tabela <code>covid</code>, uma coluna que apresenta o mês ao qual cada linha se encontra. Suponha ainda, que você deseja calcular a média mensal de novos casos diários em cada estado. Para realizar essa ação, você precisa aplicar o cálculo da média não apenas dentro de cada estado, mas também, dentro de cada mês disponível na base. Logo, precisamos fornecer tanto a coluna <code>estado</code> quanto a coluna <code>mes</code> à função <code>group_by()</code>, como no exemplo abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>covid_novo <span class="sc">%&gt;%</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mes =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(data, <span class="st">"%m"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estado, mes) <span class="sc">%&gt;%</span> </span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">media_novos_casos =</span> <span class="fu">mean</span>(casos_var, <span class="at">na.rm =</span> T)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 136 × 3
# Groups:   estado [27]
  estado   mes media_novos_casos
  &lt;chr&gt;  &lt;int&gt;             &lt;dbl&gt;
1 AC         3              2.79
2 AC         4             12.1 
3 AC         5            188.  
4 AC         6            234.  
5 AC         7            205.  
# ℹ 131 more rows</code></pre>
</div>
</div>
<p>Perceba também acima, que utilizamos a função <code>ungroup()</code> sobre a tabela <code>covid_novo</code>, antes de aplicarmos a função <code>group_by()</code>. O motivo para tal operação, está no fato de que a tabela <code>covid_novo</code> já se encontrava agrupada desde o momento em que ela foi criada. Por isso, antes de aplicarmos novamente a função <code>group_by()</code> com o uso das colunas <code>estado</code> e <code>mes</code>, precisamos remover a definição de grupos anterior. Tudo que a função <code>ungroup()</code> faz é remover a definição de grupos anterior da tabela (caso uma definição de grupos de fato exista na tabela).</p>
<p>Portanto, a partir do momento em que você “terminou” de utilizar as operações “por grupo” em sua tabela, e deseja ignorar novamente esses grupos em suas próximas etapas, você deve retirar a definição dos grupos de sua tabela, por meio da função <code>ungroup()</code>.</p>
</section>
<section id="distribuindo-cálculos-com-a-função-across" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="distribuindo-cálculos-com-a-função-across"><span class="header-section-number">5.10</span> Distribuindo cálculos com a função <code>across()</code></h2>
<p>A função <code>across()</code> lhe permite aplicar os métodos de seleção que vimos em <code>select()</code> dentro dos demais verbos do pacote <code>dplyr</code> (<code>mutate()</code>, <code>summarise()</code> e <code>arrange()</code>). Para mais, o principal objetivo dessa função está em prover uma maneira muito mais prática de empregarmos uma mesma operação ao longo de (daí o nome de <em>across</em>) várias colunas.</p>
<p>Por exemplo, suponha que você desejasse calcular o logaritmo de todas as colunas numéricas da tabela <code>mpg</code>. Temos então, que aplicar a mesma operação sobre 5 colunas diferentes, mais especificamente, as colunas <code>displ</code>, <code>year</code>, <code>cyl</code>, <code>cty</code> e <code>hwy</code>. Com o que vimos até o momento, você provavelmente faria tal ação da seguinte forma:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">displ =</span> <span class="fu">log</span>(displ),</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">log</span>(year),</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">cyl =</span> <span class="fu">log</span>(cyl),</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cty =</span> <span class="fu">log</span>(cty),</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">hwy =</span> <span class="fu">log</span>(hwy)</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Porém, além de ser tedioso repetir o mesmo código várias vezes, você incorre em uma grande chance de erro. Pois os nossos olhos tendem a prestar atenção no que é diferente dos demais, no que se destaca do ambiente, e não sobre blocos e blocos de comandos que são basicamente idênticos.</p>
<p>Com isso, a função <code>across()</code> provê um excelente mecanismo para automatizarmos essa aplicação. Nessa função, temos dois argumentos principais a serem preenchidos: 1)<code>.cols</code>, que representa o conjunto de colunas onde a ação desejada será aplicada; 2) <code>.fns</code>, a função ou a expressão que será empregada em cada coluna (neste argumento, você pode fornecer apenas o nome da função). Com isso, poderíamos reescrever a operação anterior como:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Aplicar log() na terceira, quarta,</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="do">## quinta, oitava e nona coluna da tabela mpg:</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">8</span><span class="sc">:</span><span class="dv">9</span>), <span class="at">.fns =</span> log))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 11
  manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
  &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 audi         a4    0.588  7.60  1.39 auto(l5)   f      2.89  3.37 p     compa…
2 audi         a4    0.588  7.60  1.39 manual(m5) f      3.04  3.37 p     compa…
3 audi         a4    0.693  7.60  1.39 manual(m6) f      3.00  3.43 p     compa…
4 audi         a4    0.693  7.60  1.39 auto(av)   f      3.04  3.40 p     compa…
5 audi         a4    1.03   7.60  1.79 auto(l5)   f      2.77  3.26 p     compa…
# ℹ 229 more rows</code></pre>
</div>
</div>
<p>Portanto, em <code>across()</code> você é capaz de aplicar qualquer um dos 5 métodos que vimos em <code>select()</code>. Como um outro exemplo, podemos aplicar a função <code>log()</code> sobre qualquer coluna que se inicie pela letra “h”, com o comando abaixo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="st">"h"</span>), <span class="at">.fns =</span> log))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 11
  manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
  &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 audi         a4      1.8  1999     4 auto(l5)   f        18  3.37 p     compa…
2 audi         a4      1.8  1999     4 manual(m5) f        21  3.37 p     compa…
3 audi         a4      2    2008     4 manual(m6) f        20  3.43 p     compa…
4 audi         a4      2    2008     4 auto(av)   f        21  3.40 p     compa…
5 audi         a4      2.8  1999     6 auto(l5)   f        16  3.26 p     compa…
# ℹ 229 more rows</code></pre>
</div>
</div>
<p>Por outro lado, caso você necessite aplicar várias funções em cada coluna, é melhor que você crie uma nova função (a partir da palavra-chave <code>function</code>) dentro de <code>across()</code>, contendo as operações que você deseja aplicar. Pois dessa maneira, você possui um melhor controle sobre em que partes do cálculo, os valores de cada coluna serão posicionados.</p>
<p>Por exemplo, podemos normalizar todas as colunas numéricas da tabela <code>mpg</code>, por uma estatística Z. Perceba abaixo, que nesse caso, precisamos utilizar o valor da coluna em 3 ocasiões: duas vezes no numerador, para calcularmos o desvio de cada valor da coluna em relação a sua média; e uma vez no denominador, para calcularmos o desvio padrão. Repare também, que ao menos quatro funções são utilizadas dentro desse cálculo: as funções <code>mean()</code> e <code>sd()</code>, além dos operadores de subtração (<code>-</code>) e de divisão (<code>/</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> <span class="cf">function</span>(x) x <span class="sc">-</span> <span class="fu">mean</span>(x) <span class="sc">/</span> <span class="fu">sd</span>(x)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 234 × 11
  manufacturer model  displ  year   cyl trans      drv     cty   hwy fl    class
  &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
1 audi         a4    -0.887 1555. 0.346 auto(l5)   f      14.0  25.1 p     comp…
2 audi         a4    -0.887 1555. 0.346 manual(m5) f      17.0  25.1 p     comp…
3 audi         a4    -0.687 1564. 0.346 manual(m6) f      16.0  27.1 p     comp…
4 audi         a4    -0.687 1564. 0.346 auto(av)   f      17.0  26.1 p     comp…
5 audi         a4     0.113 1555. 2.35  auto(l5)   f      12.0  22.1 p     comp…
# ℹ 229 more rows</code></pre>
</div>
</div>
<p>Com isso, a função <code>summarise()</code> também se torna um local extremamente útil para o emprego da função <code>across()</code>. Pois através de <code>across()</code>, nós podemos rapidamente aplicar uma função sobre cada coluna que desejamos sintetizar com <code>summarise()</code>. Por exemplo, somos capazes de extrair o valor total de todas as colunas numéricas da tabela <code>mpg</code>, por meio dos seguintes comandos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> sum</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
    cyl displ   year   cty   hwy
  &lt;int&gt; &lt;dbl&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;
1     4  174. 162243  1702  2333
2     5   10    8032    82   115
3     6  269. 158227  1281  1803
4     8  359. 140317   880  1234</code></pre>
</div>
</div>
</section>
<section id="removendo-duplicatas-com-distinct" class="level2" data-number="5.11">
<h2 data-number="5.11" class="anchored" data-anchor-id="removendo-duplicatas-com-distinct"><span class="header-section-number">5.11</span> Removendo duplicatas com <code>distinct()</code></h2>
<p>Às vezes, os nossos dados chegam com algum erro de registro, e usualmente, esse erro se manifesta na forma de registros duplicados. Nessa seção, veremos o uso da função <code>distinct()</code> como um mecanismo útil para eliminarmos observações duplicadas em sua tabela. Como um exemplo inicial, podemos utilizar a tabela <code>ponto</code>, criada pelos comandos abaixo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>ponto <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">usuario =</span> <span class="st">"Ana"</span>,</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hora =</span> <span class="fu">c</span>(<span class="dv">14</span>, <span class="dv">14</span>, <span class="dv">18</span>, <span class="dv">8</span>, <span class="dv">13</span>),</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">minuto =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">0</span>, <span class="dv">30</span>),</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tipo =</span> <span class="fu">c</span>(<span class="st">"E"</span>, <span class="st">"E"</span>, <span class="st">"S"</span>, <span class="st">"E"</span>, <span class="st">"E"</span>),</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">mes =</span> <span class="dv">3</span>,</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ano =</span> <span class="dv">2020</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>ponto</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
  usuario   dia  hora minuto tipo    mes   ano
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Ana         1    14     30 E         3  2020
2 Ana         1    14     30 E         3  2020
3 Ana         1    18     50 S         3  2020
4 Ana         2     8      0 E         3  2020
5 Ana         2    13     30 E         3  2020</code></pre>
</div>
</div>
<p>Inicialmente, a função <code>distinct()</code> funciona da mesma maneira que a função <code>unique()</code>. Porém, a função <code>unique()</code>: 1) pode ser aplicada em praticamente qualquer tipo de estrutura; 2) o tipo de estrutura adotado em seu resultado tende a variar em diversas aplicações. Já a função <code>distinct()</code> (assim como as demais funções do pacote <code>dplyr</code>) irá sempre aceitar um <code>data.frame</code> como <em>input</em> e gerar um novo <code>data.frame</code> como <em>output</em>. Logo, se aplicarmos <code>distinct()</code> sobre a tabela <code>ponto</code>, temos o seguinte resultado:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>ponto_dis <span class="ot">&lt;-</span> <span class="fu">distinct</span>(ponto)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>ponto_dis</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  usuario   dia  hora minuto tipo    mes   ano
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Ana         1    14     30 E         3  2020
2 Ana         1    18     50 S         3  2020
3 Ana         2     8      0 E         3  2020
4 Ana         2    13     30 E         3  2020</code></pre>
</div>
</div>
<p>Repare no resultado acima, que a função <code>distinct()</code> eliminou a segunda linha da tabela <code>ponto</code>, pois essa era uma duplicata da primeira linha. Para mais, a função <code>distinct()</code> nos permite aplicar a função sobre colunas específicas do <code>data.frame</code> em questão. No exemplo acima, nós omitimos essa funcionalidade, e pedimos para que a função <code>distinct()</code> fosse aplicada sobre a toda a tabela. Isso significa, que ao não definirmos uma coluna ou um conjunto de colunas em particular, <code>distinct()</code> vai utilizar a combinação dos valores de todas as colunas para determinar os valores únicos presentes em sua tabela e, portanto, eliminar os valores duplicados segundo essa abordagem.</p>
<p>Como exemplo, podemos aplicar a função sobre as colunas <code>usuario</code> e <code>tipo</code>. Dessa forma, <code>distinct()</code> nos retorna um novo <code>data.frame</code> contendo os valores únicos presentes nessas colunas. No entanto, perceba que um efeito colateral foi gerado, pois nós perdemos todas as demais colunas da tabela <code>ponto</code> durante o processo. Isso ocorre em todas as ocasiões em que listamos uma combinação de colunas em <code>distinct()</code>. Para evitar esse comportamento, você pode definir o argumento <code>.keep_all</code> para <code>TRUE</code>, como no exemplo abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>ponto_dis <span class="ot">&lt;-</span> <span class="fu">distinct</span>(ponto, usuario, tipo)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>ponto_dis</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  usuario tipo 
  &lt;chr&gt;   &lt;chr&gt;
1 Ana     E    
2 Ana     S    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>ponto_dis <span class="ot">&lt;-</span> <span class="fu">distinct</span>(ponto, usuario, tipo, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>ponto_dis</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  usuario   dia  hora minuto tipo    mes   ano
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Ana         1    14     30 E         3  2020
2 Ana         1    18     50 S         3  2020</code></pre>
</div>
</div>
<p>Com isso, se desejamos eliminar os valores duplicados em nossas tabelas, podemos rapidamente aplicar a função <code>distinct()</code> sobre toda a tabela. Contudo, haverá momentos em que combinações específicas de colunas devem ser utilizadas para determinarmos as observações únicas da tabela, ao invés de todas as colunas disponíveis. Para isso, você deve listar os nomes das colunas a serem utilizadas pela função <code>distinct()</code> neste processo. Além disso, você geralmente vai desejar utilizar a configuração <code>.keep_all = TRUE</code> durante essa situação, com o objetivo de conservar as demais colunas da tabela no resultado de <code>distinct()</code>.</p>
<p>Ademais, lembre-se que você pode utilizar a função <code>across()</code> para ter acesso aos mecanismos de seleção de <code>select()</code>, para definir o conjunto de colunas a ser empregado por <code>distinct()</code>. Por exemplo, eu posso encontrar todos os valores únicos criados pela combinação entre as colunas <code>dia</code> e <code>tipo</code>, por meio do seguinte comando:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(ponto, <span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>)), <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 7
  usuario   dia  hora minuto tipo    mes   ano
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Ana         1    14     30 E         3  2020
2 Ana         1    18     50 S         3  2020
3 Ana         2     8      0 E         3  2020</code></pre>
</div>
</div>
</section>
<section id="combinando-tabelas-com-bind_cols-e-bind_rows" class="level2" data-number="5.12">
<h2 data-number="5.12" class="anchored" data-anchor-id="combinando-tabelas-com-bind_cols-e-bind_rows"><span class="header-section-number">5.12</span> Combinando tabelas com <code>bind_cols()</code> e <code>bind_rows()</code></h2>
<p>Os pacotes básicos do R oferecem as funções <code>rbind()</code> e <code>cbind()</code>, que lhe permite combinar objetos. Porém, o pacote <code>dplyr</code> oferece implementações mais rápidas e completas desse mecanismo, através das funções <code>bind_cols()</code> e <code>bind_rows()</code>. Do mesmo modo que as demais funções do pacote, <code>bind_cols()</code> e <code>bind_rows()</code> aceitam um conjunto de <code>data.frame</code>’s como <em>input</em>, e lhe retornam um novo <code>data.frame</code> como <em>output</em>.</p>
<p>Como exemplo inicial, suponha que você possua o conjunto de tabelas abaixo. Essas tabelas contêm dados das vendas de três lojas diferentes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>savassi <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2020-03-01"</span>, <span class="st">"2020-03-02"</span>, <span class="st">"2020-03-03"</span>,</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"2020-03-04"</span>)),</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">produtoid =</span> <span class="fu">c</span>(<span class="st">"10241"</span>, <span class="st">"10241"</span>, <span class="st">"10032"</span>, <span class="st">"15280"</span>),</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">loja =</span> <span class="st">"Savassi"</span>,</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidades =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(<span class="fl">15.5</span>, <span class="dv">31</span>, <span class="fl">12.4</span>, <span class="fl">16.7</span>)</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>prado <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2020-03-10"</span>, <span class="st">"2020-03-11"</span>, <span class="st">"2020-03-12"</span>)),</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">produtoid =</span> <span class="fu">c</span>(<span class="st">"15280"</span>, <span class="st">"10032"</span>, <span class="st">"10032"</span>),</span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">loja =</span> <span class="st">"Prado"</span>,</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidades =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>),</span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(<span class="fl">50.1</span>, <span class="fl">49.6</span>, <span class="fl">24.8</span>)</span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a>centro <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2020-03-07"</span>, <span class="st">"2020-03-10"</span>, <span class="st">"2020-03-12"</span>)),</span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">produtoid =</span> <span class="fu">c</span>(<span class="st">"15280"</span>, <span class="st">"15280"</span>, <span class="st">"15280"</span>),</span>
<span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">loja =</span> <span class="st">"Centro"</span>,</span>
<span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">unidades =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb122-23"><a href="#cb122-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">c</span>(<span class="fl">83.5</span>, <span class="fl">16.7</span>, <span class="fl">16.7</span>)</span>
<span id="cb122-24"><a href="#cb122-24" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Supondo que você seja um analista da empresa dona dessas lojas, e que foi delegado a você, a tarefa de analisar os dados dessas tabelas, você terá no mínimo o triplo de trabalho, caso mantenha essas tabelas separadas. Pois cada etapa de sua análise teria de ser replicar em três lugares diferentes. Por isso, a melhor opção é reunir essas tabelas em um lugar só. Pois dessa maneira, você precisa aplicar as suas operações em um único lugar.</p>
<p>Ou seja, a motivação para o uso das funções <code>bind_rows()</code> e <code>bind_cols()</code>, surge em geral, a partir da dificuldade que temos em aplicar a mesma função em diversos pontos de nosso trabalho, além da manutenção e monitoramento dos resultados gerados em cada um desses pontos envolvidos nesse serviço. Portanto, se você possui um grande conjunto de tabelas, que são semelhantes entre si, e você precisa aplicar os mesmos passos sobre cada uma delas, é interessante que você tente juntar essas tabelas em uma só. Dessa maneira, você pode direcionar o seu foco e as suas energias para um só local.</p>
<p>Como as tabelas <code>savassi</code>, <code>prado</code> e <code>centro</code> possuem as mesmas colunas, faz mais sentido unirmos as linhas de cada tabela para formarmos a nossa tabela única. Para isso, basta listarmos essas tabelas dentro da função <code>bind_rows()</code>, como demonstrado abaixo. Uma outra opção, seria provermos uma lista de <code>data.frame</code>’s à função, o que também está demonstrado abaixo:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(savassi, prado, centro)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
  dia        produtoid loja    unidades valor
  &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
1 2020-03-01 10241     Savassi        1  15.5
2 2020-03-02 10241     Savassi        2  31  
3 2020-03-03 10032     Savassi        1  12.4
4 2020-03-04 15280     Savassi        1  16.7
5 2020-03-10 15280     Prado          3  50.1
# ℹ 5 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Uma alternativa seria fornecermos uma lista</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="do">## contendo as tabelas a serem unidas:</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>lista <span class="ot">&lt;-</span> <span class="fu">list</span>(savassi, prado, centro)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(lista)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Portanto, ao unir as linhas de cada tabela, a função <code>bind_rows()</code> está de certa forma “empilhando” uma tabela em cima da outra. Mas para que este tipo de operação ocorra de maneira adequada, é <strong>importante que as colunas de todas as tabelas estejam nomeadas igualmente</strong>. Dito de outra forma, as tabelas envolvidas nesse cálculo, devem ser formadas pelo mesmo grupo de colunas. Essas colunas podem se encontrar em ordens diferentes ao longo das tabelas, mas elas precisam necessariamente estar nomeadas da mesma maneira. Caso alguma coluna em pelo menos uma das tabelas possua um nome diferente de seus pares, a função vai alocar os seus valores em uma coluna separada das demais, e isso geralmente não é o que você deseja.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(centro)[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ProdutoID"</span>, <span class="st">"Loja"</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(savassi, prado, centro)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 7
  dia        produtoid loja    unidades valor ProdutoID Loja 
  &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;
1 2020-03-01 10241     Savassi        1  15.5 &lt;NA&gt;      &lt;NA&gt; 
2 2020-03-02 10241     Savassi        2  31   &lt;NA&gt;      &lt;NA&gt; 
3 2020-03-03 10032     Savassi        1  12.4 &lt;NA&gt;      &lt;NA&gt; 
4 2020-03-04 15280     Savassi        1  16.7 &lt;NA&gt;      &lt;NA&gt; 
5 2020-03-10 15280     Prado          3  50.1 &lt;NA&gt;      &lt;NA&gt; 
# ℹ 5 more rows</code></pre>
</div>
</div>
<p>Por outro lado, quando estamos planejando unir tabelas a partir de suas colunas, a nossa preocupação principal deve ser com o número de linhas de cada tabela. Com isso, quando utilizar a função <code>bind_cols()</code>, é <strong>essencial que as tabelas envolvidas possuam exatamente o mesmo número de linhas</strong>. Ou seja, no caso da função <code>bind_cols()</code>, é primordial que as tabelas fornecidas à função, possuam o mesmo número de linhas, pois caso contrário, um erro será acionado pela função, e você não poderá prosseguir.</p>
<p>Tendo esse ponto em mente, você utiliza a função <code>bind_cols()</code> do mesmo modo que a função <code>bind_rows()</code>. Basta listar as tabelas a serem unidas dentro da função, ou fornecer uma lista contendo os <code>data.frame</code>’s a serem fundidos. Veja abaixo, um exemplo com as tabelas <code>tab1</code> e <code>tab2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>tab1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dia =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">valor =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">5</span>), <span class="dv">2</span>)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>tab2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"104"</span>, <span class="st">"104"</span>, <span class="st">"105"</span>, <span class="st">"106"</span>, <span class="st">"106"</span>),</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nome =</span> <span class="st">"Ana"</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(tab1, tab2)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
    dia valor id    nome 
  &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
1     1  1.13 104   Ana  
2     2  1.11 104   Ana  
3     3 -0.87 105   Ana  
4     4  0.21 106   Ana  
5     5  0.07 106   Ana  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Uma alternativa seria fornecermos uma lista</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="do">## contendo as tabelas a serem unidas:</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>lista <span class="ot">&lt;-</span> <span class="fu">list</span>(tab1, tab2)</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(lista)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<div id="refs" class="references csl-bib-body" data-entry-spacing="1" role="list">
<div id="ref-peng2015" class="csl-entry" role="listitem">
PENG, R. D. <strong><a href="https://bookdown.org/rdpeng/rprogdatascience/">R Programming for Data Science</a></strong>. [s.l.] Leanpub, 2015.
</div>
<div id="ref-wickham2017" class="csl-entry" role="listitem">
WICKHAM, H.; GROLEMUND, G. <strong><a href="https://r4ds.had.co.nz">R for Data Science</a></strong>. Sebastopol, CA: O’Reilly Media, Inc., 2017.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p><a href="https://dplyr.tidyverse.org/" class="uri">https://dplyr.tidyverse.org/</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Essa função pertence ao pacote <code>RcppRoll</code> e, portanto, para ter acesso à função você deve possuir esse pacote instalado em sua máquina, e chamar por ele em sua sessão.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Capítulos/03-importacao.html" class="pagination-link" aria-label="Importando e exportando dados com `readr`, `readxl` e `haven`">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Importando e exportando dados com <code>readr</code>, <code>readxl</code> e <code>haven</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Capítulos/06-dados-relacionais.html" class="pagination-link" aria-label="Introdução a base de dados relacionais com `dplyr`">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introdução a base de dados relacionais com <code>dplyr</code></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>